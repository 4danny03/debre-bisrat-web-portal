import{j as e}from"./ui-BKKtghGE.js";import{R as q,a as p}from"./vendor-DsXQwQzb.js";import{ag as J,ah as Q,ai as K,x as m,y as x,z as u,J as h,l as E,t as V,T as M,V as G,w as g,a5 as I,O as N,R as B,A as k,m as Z,k as W}from"./index-BzL-sfoN.js";import{B as C}from"./badge-ClsmbL3M.js";import{T as X,a as Y,b as R,c as A}from"./tabs-DhF-Biq5.js";import{Z as _,S as $,D as F,H as ee}from"./zap-DEMDaukD.js";import{C as H}from"./circle-x-Dib2-vLt.js";import{A as se}from"./activity-fusBBDSA.js";const te=J,ae=Q,ne=K,re=a=>{if(!Array.isArray(a)||a.length===0)return{};const i={Database:[],API:[],Authentication:[],"Edge Functions":[],"Admin Helpers":[],"Data Sync":[],"Email Marketing":[],Other:[]};return a.forEach(t=>{const{name:l}=t;l.includes("Database")||l.includes("Table Access")?i.Database.push(t):l.includes("API:")?i.API.push(t):l.includes("Authentication")?i.Authentication.push(t):l.includes("Edge Function")?i["Edge Functions"].push(t):l.includes("Admin Helper")?i["Admin Helpers"].push(t):l.includes("Data Sync")?i["Data Sync"].push(t):l.includes("Email")||l.includes("Newsletter")||l.includes("Campaign")?i["Email Marketing"].push(t):i.Other.push(t)}),Object.keys(i).forEach(t=>{i[t].length||delete i[t]}),i},ie=a=>{switch(a){case"Database":return e.jsx(F,{className:"h-4 w-4"});case"API":return e.jsx($,{className:"h-4 w-4"});case"Authentication":return e.jsx(V,{className:"h-4 w-4"});case"Edge Functions":return e.jsx(_,{className:"h-4 w-4"});default:return e.jsx(E,{className:"h-4 w-4"})}},ce=a=>a&&typeof a=="object"&&typeof a.name=="string"&&typeof a.status=="string"&&["pass","fail","warning"].includes(a.status)&&typeof a.message=="string",le=a=>Array.isArray(a)?a.filter(ce):[],oe={pass:"text-green-600 border-green-200 bg-green-50",fail:"text-red-600 border-red-200 bg-red-50",warning:"text-yellow-700 border-yellow-200 bg-yellow-50"},de={pass:e.jsx(E,{className:"h-4 w-4 text-green-600"}),fail:e.jsx(H,{className:"h-4 w-4 text-red-600"}),warning:e.jsx(M,{className:"h-4 w-4 text-yellow-700"})},me=({results:a})=>{const i=le(a),t=re(i),l=i.reduce((o,y)=>(o[y.status]++,o),{pass:0,fail:0,warning:0}),[f,S]=q.useState({});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(m,{children:[e.jsx(x,{children:e.jsx(u,{children:"System Diagnostics Summary"})}),e.jsxs(h,{className:"flex gap-4",children:[e.jsxs(C,{className:"bg-green-50 text-green-700 border border-green-200",children:["Pass: ",l.pass]}),e.jsxs(C,{className:"bg-yellow-50 text-yellow-700 border border-yellow-200",children:["Warning: ",l.warning]}),e.jsxs(C,{className:"bg-red-50 text-red-700 border border-red-200",children:["Fail: ",l.fail]})]})]}),Object.entries(t).map(([o,y])=>e.jsxs(te,{open:!!f[o],onOpenChange:d=>S(b=>({...b,[o]:d})),children:[e.jsx(ae,{asChild:!0,children:e.jsx(m,{className:"cursor-pointer hover:shadow-md transition",children:e.jsxs(x,{className:"flex flex-row items-center gap-2",children:[ie(o),e.jsx(u,{className:"flex-1",children:o}),e.jsxs(C,{variant:"outline",children:[y.length," tests"]})]})})}),e.jsx(ne,{children:e.jsx(h,{className:"space-y-2",children:y.map((d,b)=>e.jsxs("div",{className:`flex items-center gap-2 border rounded px-2 py-1 ${oe[d.status]}`,children:[de[d.status],e.jsx("span",{className:"font-medium",children:d.name}),e.jsx("span",{className:"text-xs",children:d.message}),d.error&&e.jsx("span",{className:"text-xs text-red-500",children:String(d.error)})]},b))})})]},o))]})};function ve(){const[a,i]=p.useState([]),[t,l]=p.useState(null),[f,S]=p.useState(!0),[o,y]=p.useState(null),[d,b]=p.useState(!0),[T,L]=p.useState(6e4),{toast:j}=G();p.useEffect(()=>{D()},[]),p.useEffect(()=>{if(!d)return;const s=setInterval(D,T);return()=>clearInterval(s)},[d,T]);const D=async()=>{S(!0);const s=[];try{const n=Date.now(),{error:c}=await g.from("profiles").select("id").limit(1),r=Date.now()-n;s.push({name:"Database Connection",status:c?"error":"healthy",message:c?`Connection failed: ${c.message}`:"Connected successfully",lastChecked:new Date,responseTime:r})}catch{s.push({name:"Database Connection",status:"error",message:"Connection failed",lastChecked:new Date})}try{const n=Date.now(),{error:c}=await g.storage.from("images").list("",{limit:1}),r=Date.now()-n;s.push({name:"Storage Bucket",status:c?"error":"healthy",message:c?`Storage error: ${c.message}`:"Storage accessible",lastChecked:new Date,responseTime:r})}catch{s.push({name:"Storage Bucket",status:"error",message:"Storage check failed",lastChecked:new Date})}try{const[n,c,r]=await Promise.all([g.from("events").select("*",{count:"exact",head:!0}),g.from("members").select("*",{count:"exact",head:!0}),g.from("donations").select("*",{count:"exact",head:!0})]),v=(n.count||0)+(c.count||0)+(r.count||0);s.push({name:"Data Integrity",status:"healthy",message:`${v} total records found`,lastChecked:new Date,details:{events:n.count||0,members:c.count||0,donations:r.count||0}})}catch{s.push({name:"Data Integrity",status:"warning",message:"Could not verify data integrity",lastChecked:new Date})}s.push({name:"Email System",status:"healthy",message:"Email service operational",lastChecked:new Date}),s.push({name:"Payment System",status:"healthy",message:"Stripe integration active",lastChecked:new Date});try{const n=Date.now(),{data:c,error:r}=await g.functions.invoke("supabase-functions-admin-dashboard",{body:{action:"ping"}}),v=Date.now()-n;s.push({name:"Edge Functions",status:r?"warning":"healthy",message:r?"Ping failed":"Ping ok",lastChecked:new Date,responseTime:v})}catch{s.push({name:"Edge Functions",status:"warning",message:"Ping failed",lastChecked:new Date})}i(s),y(new Date),await z(),S(!1)},z=async()=>{try{const{data:s}=await g.storage.from("images").list(),n={database:{connections:12,queries:1547,avgResponseTime:45,storage:{used:2.3,total:10,percentage:23}},api:{uptime:99.8,requests:8432,errors:12,avgResponseTime:120},storage:{images:{count:(s==null?void 0:s.length)||0,size:156.7},documents:{count:0,size:0}}};l(n)}catch(s){console.error("Error loading metrics:",s)}},O=s=>{switch(s){case"healthy":return e.jsx(E,{className:"h-5 w-5 text-green-600"});case"warning":return e.jsx(M,{className:"h-5 w-5 text-yellow-600"});case"error":return e.jsx(H,{className:"h-5 w-5 text-red-600"})}},U=()=>{var v;const s={generatedAt:new Date().toISOString(),lastUpdate:(o==null?void 0:o.toISOString())||null,overallStatus:w,healthChecks:a,metrics:t,client:{online:typeof navigator<"u"?navigator.onLine:void 0,connection:(v=navigator==null?void 0:navigator.connection)==null?void 0:v.effectiveType}},n=new Blob([JSON.stringify(s,null,2)],{type:"application/json"}),c=URL.createObjectURL(n),r=document.createElement("a");r.href=c,r.download=`system-health-${I(new Date,"yyyy-MM-dd-HH-mm-ss")}.json`,document.body.appendChild(r),r.click(),r.remove(),URL.revokeObjectURL(c),j({title:"Report downloaded"})},P=s=>{const n={healthy:"default",warning:"secondary",error:"destructive"};return e.jsx(C,{variant:n[s],className:"capitalize",children:s})},w=a.length>0?a.some(s=>s.status==="error")?"error":a.some(s=>s.status==="warning")?"warning":"healthy":"healthy";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-church-burgundy",children:"System Health"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Monitor system status and performance metrics"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:d,onChange:s=>b(s.target.checked)}),"Auto-refresh"]}),e.jsxs("select",{value:String(T),onChange:s=>L(Number(s.target.value)),className:"border rounded px-2 py-1 text-sm",children:[e.jsx("option",{value:"15000",children:"15s"}),e.jsx("option",{value:"30000",children:"30s"}),e.jsx("option",{value:"60000",children:"1m"}),e.jsx("option",{value:"120000",children:"2m"})]})]}),o&&e.jsxs("span",{className:"text-sm text-gray-500",children:["Last updated: ",I(o,"HH:mm:ss")]}),e.jsxs(N,{onClick:D,variant:"outline",disabled:f,children:[e.jsx(B,{className:`h-4 w-4 mr-2 ${f?"animate-spin":""}`}),"Refresh"]}),e.jsx(N,{onClick:U,children:"Export Report"})]})]}),e.jsx(me,{}),e.jsxs(m,{className:"mt-6",children:[e.jsx(x,{children:e.jsxs(u,{className:"flex items-center space-x-2",children:[O(w),e.jsx("span",{children:"System Status"})]})}),e.jsx(h,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-church-burgundy capitalize",children:w==="healthy"?"All Systems Operational":w==="warning"?"Some Issues Detected":"Critical Issues Found"}),e.jsxs("p",{className:"text-gray-600",children:[a.filter(s=>s.status==="healthy").length," of"," ",a.length," services healthy"]})]}),P(w)]})})]}),e.jsxs(X,{defaultValue:"health",className:"space-y-6",children:[e.jsxs(Y,{className:"grid w-full grid-cols-4",children:[e.jsx(R,{value:"health",children:"Health Checks"}),e.jsx(R,{value:"metrics",children:"System Metrics"}),e.jsx(R,{value:"logs",children:"System Logs"}),e.jsx(R,{value:"tests",children:"Quick Tests"})]}),e.jsx(A,{value:"health",className:"space-y-4",children:a.map((s,n)=>e.jsx(m,{children:e.jsx(h,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[O(s.status),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600",children:s.message}),s.details&&e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:Object.entries(s.details).map(([c,r])=>e.jsxs("span",{className:"mr-3",children:[c,":"," ",typeof r=="object"?JSON.stringify(r):String(r)]},c))})]})]}),e.jsxs("div",{className:"text-right",children:[P(s.status),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:I(s.lastChecked,"HH:mm:ss")}),s.responseTime&&e.jsxs("p",{className:"text-xs text-gray-500",children:[s.responseTime,"ms"]})]})]})})},n))}),e.jsx(A,{value:"metrics",className:"space-y-6",children:t&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(m,{children:[e.jsx(x,{className:"pb-2",children:e.jsxs(u,{className:"text-sm font-medium flex items-center",children:[e.jsx(F,{className:"h-4 w-4 mr-2"}),"Database"]})}),e.jsxs(h,{children:[e.jsx("div",{className:"text-2xl font-bold text-church-burgundy",children:t.database.connections}),e.jsx("p",{className:"text-xs text-gray-500",children:"Active connections"}),e.jsxs("div",{className:"mt-2 text-xs text-gray-600",children:[e.jsxs("div",{children:["Queries: ",t.database.queries]}),e.jsxs("div",{children:["Avg response: ",t.database.avgResponseTime,"ms"]})]})]})]}),e.jsxs(m,{children:[e.jsx(x,{className:"pb-2",children:e.jsxs(u,{className:"text-sm font-medium flex items-center",children:[e.jsx($,{className:"h-4 w-4 mr-2"}),"API"]})}),e.jsxs(h,{children:[e.jsxs("div",{className:"text-2xl font-bold text-church-burgundy",children:[t.api.uptime,"%"]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Uptime"}),e.jsxs("div",{className:"mt-2 text-xs text-gray-600",children:[e.jsxs("div",{children:["Requests: ",t.api.requests]}),e.jsxs("div",{children:["Errors: ",t.api.errors]})]})]})]}),e.jsxs(m,{children:[e.jsx(x,{className:"pb-2",children:e.jsxs(u,{className:"text-sm font-medium flex items-center",children:[e.jsx(ee,{className:"h-4 w-4 mr-2"}),"Storage"]})}),e.jsxs(h,{children:[e.jsxs("div",{className:"text-2xl font-bold text-church-burgundy",children:[t.database.storage.percentage,"%"]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Used"}),e.jsx("div",{className:"mt-2 text-xs text-gray-600",children:e.jsxs("div",{children:[t.database.storage.used,"GB /"," ",t.database.storage.total,"GB"]})})]})]}),e.jsxs(m,{children:[e.jsx(x,{className:"pb-2",children:e.jsxs(u,{className:"text-sm font-medium flex items-center",children:[e.jsx(se,{className:"h-4 w-4 mr-2"}),"Performance"]})}),e.jsxs(h,{children:[e.jsxs("div",{className:"text-2xl font-bold text-church-burgundy",children:[t.api.avgResponseTime,"ms"]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Avg response time"})]})]})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs(m,{children:[e.jsxs(x,{children:[e.jsx(u,{children:"Storage Usage"}),e.jsx(k,{children:"File storage breakdown"})]}),e.jsxs(h,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Images"}),e.jsxs("span",{className:"text-sm font-medium",children:[t.storage.images.count," files (",t.storage.images.size," MB)"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Documents"}),e.jsxs("span",{className:"text-sm font-medium",children:[t.storage.documents.count," files (",t.storage.documents.size," MB)"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-church-burgundy h-2 rounded-full",style:{width:`${t.database.storage.percentage}%`}})})]})]}),e.jsxs(m,{children:[e.jsxs(x,{children:[e.jsx(u,{children:"Database Performance"}),e.jsx(k,{children:"Query and connection metrics"})]}),e.jsxs(h,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Active Connections"}),e.jsx("p",{className:"text-2xl font-bold text-church-burgundy",children:t.database.connections})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Queries"}),e.jsx("p",{className:"text-2xl font-bold text-church-burgundy",children:t.database.queries})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Average Response Time"}),e.jsxs("p",{className:"text-lg font-semibold",children:[t.database.avgResponseTime,"ms"]})]})]})]})]})]})}),e.jsx(A,{value:"logs",className:"space-y-4",children:e.jsxs(m,{children:[e.jsxs(x,{children:[e.jsxs(u,{className:"flex items-center",children:[e.jsx(Z,{className:"h-5 w-5 mr-2"}),"Recent System Events"]}),e.jsx(k,{children:"Latest system activities and alerts"})]}),e.jsx(h,{children:e.jsx("div",{className:"space-y-3",children:[{time:"10:30:15",level:"info",message:"Database backup completed successfully"},{time:"10:25:42",level:"info",message:"New member registration: John Doe"},{time:"10:20:18",level:"warning",message:"High memory usage detected (85%)"},{time:"10:15:33",level:"info",message:"Email campaign sent to 150 subscribers"},{time:"10:10:07",level:"error",message:"Failed to process payment for donation #1234"},{time:"10:05:21",level:"info",message:"System health check completed"}].map((s,n)=>e.jsxs("div",{className:"flex items-center space-x-3 p-3 rounded-lg bg-gray-50",children:[e.jsx("div",{className:"flex-shrink-0",children:s.level==="error"?e.jsx(H,{className:"h-4 w-4 text-red-600"}):s.level==="warning"?e.jsx(W,{className:"h-4 w-4 text-yellow-600"}):e.jsx(E,{className:"h-4 w-4 text-green-600"})}),e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"text-sm",children:s.message})}),e.jsx("div",{className:"text-xs text-gray-500",children:s.time})]},n))})})]})}),e.jsx(A,{value:"tests",className:"space-y-4",children:e.jsxs(m,{children:[e.jsxs(x,{children:[e.jsx(u,{children:"Manual Checks"}),e.jsx(k,{children:"Run ad-hoc connectivity tests"})]}),e.jsxs(h,{className:"flex flex-wrap gap-2",children:[e.jsxs(N,{variant:"outline",onClick:D,disabled:f,children:[e.jsx(B,{className:`h-4 w-4 mr-2 ${f?"animate-spin":""}`}),"Rerun All Checks"]}),e.jsx(N,{variant:"outline",onClick:async()=>{try{const s=Date.now();await g.from("events").select("id").limit(1),j({title:"DB OK",description:`${Date.now()-s}ms`})}catch{j({title:"DB Error",variant:"destructive"})}},children:"Database Ping"}),e.jsx(N,{variant:"outline",onClick:async()=>{try{const s=Date.now();await g.storage.from("images").list("",{limit:1}),j({title:"Storage OK",description:`${Date.now()-s}ms`})}catch{j({title:"Storage Error",variant:"destructive"})}},children:"Storage Ping"}),e.jsx(N,{variant:"outline",onClick:async()=>{try{const s=Date.now();await g.functions.invoke("supabase-functions-admin-dashboard",{body:{action:"ping"}}),j({title:"Edge OK",description:`${Date.now()-s}ms`})}catch{j({title:"Edge Error",variant:"destructive"})}},children:"Edge Ping"})]})]})})]})]})}export{ve as default};
