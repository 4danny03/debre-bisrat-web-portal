import{j as e}from"./ui-CIANOcUa.js";import{a as p}from"./vendor-Di3rkBj0.js";import{ak as Y,al as b,V as te,w as ae,_ as le,$ as ne,a0 as ce,O as j,a1 as re,a2 as ie,a3 as de,ae as oe,W as o,a8 as S,a9 as T,aa as F,ab as A,ac as y,Y as h,a4 as k,x as P,J as E,C as M,a5 as C,T as he,l as ue,m as xe,M as pe}from"./index-C4XDO3q4.js";import{S as je}from"./switch-D3HLDx1l.js";import{T as me,a as ve,b as N,c as ge}from"./tabs-CjbAmd7P.js";import{A as I,a as q,b as O,c as L,d as $,e as _,f as z,g as V,h as J}from"./alert-dialog-Co1IkATV.js";import{P as fe}from"./plus-CeiqPXVg.js";import{P as ye}from"./pause-n4vU0Ikt.js";import{T as W}from"./trash-2-DlTU7m4C.js";import{C as Ce}from"./circle-x-CW4isPra.js";function B(n,d){const r=Y(n);return isNaN(d)?b(n,NaN):(d&&r.setDate(r.getDate()+d),r)}function Ne(n,d){const r=Y(n);if(isNaN(d))return b(n,NaN);if(!d)return r;const m=r.getDate(),u=b(n,r.getTime());u.setMonth(r.getMonth()+d+1,0);const v=u.getDate();return m>=v?u:(r.setFullYear(u.getFullYear(),u.getMonth(),m),r)}function be(n,d){const r=d*7;return B(n,r)}function Ie(){const[n,d]=p.useState([]),[r,m]=p.useState(!0),[u,v]=p.useState(!1),[x,H]=p.useState("scheduled"),{toast:g}=te(),[a,i]=p.useState({type:"event",title:"",description:"",scheduledFor:"",scheduledTime:"",recurring:!1,frequency:"weekly",interval:1,endDate:"",emailSubject:"",emailContent:"",eventLocation:"",eventTime:""});p.useEffect(()=>{R();const s=setInterval(X,6e4);return()=>clearInterval(s)},[]);const R=async()=>{try{m(!0);const s=localStorage.getItem("scheduledContent");if(s)try{const t=JSON.parse(s);if(Array.isArray(t)){const l=t.map(c=>({...c,scheduledFor:new Date(c.scheduledFor),createdAt:new Date(c.createdAt),publishedAt:c.publishedAt?new Date(c.publishedAt):void 0}));d(l)}}catch(t){console.error("Error parsing scheduled content:",t),d([])}}catch(s){console.error("Error loading scheduled content:",s)}finally{m(!1)}},f=s=>{localStorage.setItem("scheduledContent",JSON.stringify(s)),d(s)},X=async()=>{if(!Array.isArray(n))return;const s=new Date,t=n.filter(l=>(l==null?void 0:l.status)==="scheduled"&&(l==null?void 0:l.scheduledFor)&&l.scheduledFor<=s);for(const l of t)l&&await G(l)},G=async s=>{try{let t=!1;switch(s.type){case"event":await le.events.createEvent(s.content),t=!0;break;case"email":await ae.from("email_campaigns").insert({...s.content,status:"sent",sent_at:new Date().toISOString()}),t=!1;break;default:t=!1}const l=n.map(c=>c.id===s.id?{...c,status:t?"published":"failed",publishedAt:t?new Date:void 0}:c);if(t&&s.recurring){const c=K(s.scheduledFor,s.recurring);if(!s.recurring.endDate||c<=s.recurring.endDate){const se={...s,id:Date.now().toString()+Math.random(),scheduledFor:c,status:"scheduled",publishedAt:void 0};l.push(se)}}f(l),g({title:t?"Content Published":"Publishing Failed",description:`${s.title} ${t?"has been published":"failed to publish"}`,variant:t?"default":"destructive"})}catch(t){console.error("Error publishing content:",t);const l=n.map(c=>c.id===s.id?{...c,status:"failed"}:c);f(l)}},K=(s,t)=>{if(!t)return s;switch(t.frequency){case"daily":return B(s,t.interval);case"weekly":return be(s,t.interval);case"monthly":return Ne(s,t.interval);default:return s}},Q=async()=>{if(!a.title||!a.scheduledFor){g({title:"Error",description:"Please provide title and scheduled date",variant:"destructive"});return}const s=new Date(`${a.scheduledFor}T${a.scheduledTime||"09:00"}`);let t={};switch(a.type){case"event":t={title:a.title,description:a.description,event_date:a.scheduledFor,event_time:a.eventTime,location:a.eventLocation};break;case"email":t={name:a.title,subject:a.emailSubject,content:a.emailContent};break}const l={id:Date.now().toString()+Math.random(),type:a.type,title:a.title,content:t,scheduledFor:s,status:"scheduled",recurring:a.recurring?{frequency:a.frequency,interval:a.interval,endDate:a.endDate?new Date(a.endDate):void 0}:void 0,createdAt:new Date},c=[...n,l];f(c),g({title:"Content Scheduled",description:`${a.title} has been scheduled for ${C(s,"PPP p")}`}),i({type:"event",title:"",description:"",scheduledFor:"",scheduledTime:"",recurring:!1,frequency:"weekly",interval:1,endDate:"",emailSubject:"",emailContent:"",eventLocation:"",eventTime:""}),v(!1)},U=s=>{const t=n.map(l=>l.id===s?{...l,status:"cancelled"}:l);f(t),g({title:"Content Cancelled",description:"Scheduled content has been cancelled"})},D=s=>{const t=n.filter(l=>l.id!==s);f(t),g({title:"Content Deleted",description:"Scheduled content has been deleted"})},Z=s=>{switch(s){case"scheduled":return e.jsx(xe,{className:"h-4 w-4 text-blue-600"});case"published":return e.jsx(ue,{className:"h-4 w-4 text-green-600"});case"failed":return e.jsx(Ce,{className:"h-4 w-4 text-red-600"});case"cancelled":return e.jsx(he,{className:"h-4 w-4 text-gray-600"})}},ee=s=>{switch(s){case"event":return e.jsx(M,{className:"h-4 w-4"});case"email":return e.jsx(pe,{className:"h-4 w-4"})}},w=n.filter(s=>{switch(x){case"scheduled":return s.status==="scheduled";case"published":return s.status==="published";case"failed":return s.status==="failed"||s.status==="cancelled";default:return!0}});return e.jsxs("div",{className:"space-y-6 bg-white min-h-screen p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-church-burgundy",children:"Content Scheduler"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Schedule and automate content publishing"})]}),e.jsxs(ne,{open:u,onOpenChange:v,children:[e.jsx(ce,{asChild:!0,children:e.jsxs(j,{children:[e.jsx(fe,{className:"h-4 w-4 mr-2"}),"Schedule Content"]})}),e.jsxs(re,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(ie,{children:[e.jsx(de,{children:"Schedule New Content"}),e.jsx(oe,{children:"Create content to be automatically published at a specific time"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"content-type",children:"Content Type"}),e.jsxs(S,{value:a.type,onValueChange:s=>i(t=>({...t,type:s})),children:[e.jsx(T,{children:e.jsx(F,{})}),e.jsxs(A,{children:[e.jsx(y,{value:"event",children:"Event"}),e.jsx(y,{value:"email",children:"Email Campaign"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"title",children:"Title"}),e.jsx(h,{id:"title",placeholder:"Content title",value:a.title,onChange:s=>i(t=>({...t,title:s.target.value}))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"description",children:"Description"}),e.jsx(k,{id:"description",placeholder:"Content description",value:a.description,onChange:s=>i(t=>({...t,description:s.target.value})),rows:3})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"scheduled-date",children:"Scheduled Date"}),e.jsx(h,{id:"scheduled-date",type:"date",value:a.scheduledFor,onChange:s=>i(t=>({...t,scheduledFor:s.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"scheduled-time",children:"Scheduled Time"}),e.jsx(h,{id:"scheduled-time",type:"time",value:a.scheduledTime,onChange:s=>i(t=>({...t,scheduledTime:s.target.value}))})]})]}),a.type==="event"&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"event-location",children:"Location"}),e.jsx(h,{id:"event-location",placeholder:"Event location",value:a.eventLocation,onChange:s=>i(t=>({...t,eventLocation:s.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"event-time",children:"Event Time"}),e.jsx(h,{id:"event-time",type:"time",value:a.eventTime,onChange:s=>i(t=>({...t,eventTime:s.target.value}))})]})]}),a.type==="email"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"email-subject",children:"Email Subject"}),e.jsx(h,{id:"email-subject",placeholder:"Email subject line",value:a.emailSubject,onChange:s=>i(t=>({...t,emailSubject:s.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"email-content",children:"Email Content"}),e.jsx(k,{id:"email-content",placeholder:"Email content",value:a.emailContent,onChange:s=>i(t=>({...t,emailContent:s.target.value})),rows:4})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(je,{id:"recurring",checked:a.recurring,onCheckedChange:s=>{i(t=>({...t,recurring:s}))}}),e.jsx(o,{htmlFor:"recurring",children:"Make this recurring"})]}),a.recurring&&e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"frequency",children:"Frequency"}),e.jsxs(S,{value:a.frequency,onValueChange:s=>i(t=>({...t,frequency:s})),children:[e.jsx(T,{children:e.jsx(F,{})}),e.jsxs(A,{children:[e.jsx(y,{value:"daily",children:"Daily"}),e.jsx(y,{value:"weekly",children:"Weekly"}),e.jsx(y,{value:"monthly",children:"Monthly"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"interval",children:"Interval"}),e.jsx(h,{id:"interval",type:"number",min:"1",value:a.interval,onChange:s=>i(t=>({...t,interval:parseInt(s.target.value)||1}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"end-date",children:"End Date (Optional)"}),e.jsx(h,{id:"end-date",type:"date",value:a.endDate,onChange:s=>i(t=>({...t,endDate:s.target.value}))})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[e.jsx(j,{variant:"outline",onClick:()=>v(!1),children:"Cancel"}),e.jsx(j,{onClick:Q,children:"Schedule Content"})]})]})]})]})]}),e.jsxs(me,{value:x,onValueChange:H,children:[e.jsxs(ve,{className:"grid w-full grid-cols-3",children:[e.jsxs(N,{value:"scheduled",children:["Scheduled (",n.filter(s=>s.status==="scheduled").length,")"]}),e.jsxs(N,{value:"published",children:["Published (",n.filter(s=>s.status==="published").length,")"]}),e.jsxs(N,{value:"failed",children:["Failed/Cancelled (",n.filter(s=>s.status==="failed"||s.status==="cancelled").length,")"]})]}),e.jsx(ge,{value:x,className:"space-y-4",children:r?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-church-burgundy"})}):w.length===0?e.jsx(P,{children:e.jsxs(E,{className:"text-center py-8",children:[e.jsx(M,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsxs("p",{className:"text-gray-500",children:["No ",x," content"]}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:x==="scheduled"?"Schedule some content to get started":`No ${x} content found`})]})}):e.jsx("div",{className:"grid gap-4",children:w.map(s=>e.jsx(P,{children:e.jsx(E,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[ee(s.type),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:s.title}),e.jsx("p",{className:"text-sm text-gray-600 capitalize",children:s.type}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Scheduled for: ",C(s.scheduledFor,"PPP p")]}),s.recurring&&e.jsxs("p",{className:"text-xs text-blue-600",children:["Recurring: Every ",s.recurring.interval," ",s.recurring.frequency]}),s.publishedAt&&e.jsxs("p",{className:"text-xs text-green-600",children:["Published: ",C(s.publishedAt,"PPP p")]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[Z(s.status),e.jsx("span",{className:"text-sm capitalize font-medium",children:s.status}),s.status==="scheduled"&&e.jsxs("div",{className:"flex space-x-1 ml-4",children:[e.jsx(j,{size:"sm",variant:"outline",onClick:()=>U(s.id),children:e.jsx(ye,{className:"h-3 w-3"})}),e.jsxs(I,{children:[e.jsx(q,{asChild:!0,children:e.jsx(j,{size:"sm",variant:"outline",children:e.jsx(W,{className:"h-3 w-3"})})}),e.jsxs(O,{children:[e.jsxs(L,{children:[e.jsx($,{children:"Delete Scheduled Content"}),e.jsxs(_,{children:['Are you sure you want to delete "',s.title,'"? This action cannot be undone.']})]}),e.jsxs(z,{children:[e.jsx(V,{children:"Cancel"}),e.jsx(J,{onClick:()=>D(s.id),children:"Delete"})]})]})]})]}),(s.status==="failed"||s.status==="cancelled")&&e.jsxs(I,{children:[e.jsx(q,{asChild:!0,children:e.jsx(j,{size:"sm",variant:"outline",children:e.jsx(W,{className:"h-3 w-3"})})}),e.jsxs(O,{children:[e.jsxs(L,{children:[e.jsx($,{children:"Delete Content"}),e.jsxs(_,{children:['Are you sure you want to delete "',s.title,'"? This action cannot be undone.']})]}),e.jsxs(z,{children:[e.jsx(V,{children:"Cancel"}),e.jsx(J,{onClick:()=>D(s.id),children:"Delete"})]})]})]})]})]})})},s.id))})})]})]})}export{Ie as default};
