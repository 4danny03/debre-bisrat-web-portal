import{j as e}from"./ui-BKKtghGE.js";import{a as i}from"./vendor-DsXQwQzb.js";import{T as q,a as O,b as _,c as u,d as I,e as v}from"./table-DO2FNJGZ.js";import{V as $,w as A,x as o,y as m,z as x,J as h,l as C,m as D,U as J,W as f,Y as V,O as n,A as W,a5 as M,$ as Y,a1 as G,a2 as K,a3 as Q,ae as X}from"./index-BzL-sfoN.js";import{A as Z,a as ee,b as se,c as ae,d as te,e as le,f as ie,g as re,h as ne}from"./alert-dialog-eI1wU_YY.js";import{B as N}from"./badge-ClsmbL3M.js";import{M as ce}from"./message-square-Dz3KcmE4.js";import{S as de}from"./search-Bnz3bGms.js";import{T as F,a as k}from"./thumbs-up-e7ihudem.js";import{T as oe}from"./trash-2-COsc09J2.js";function Te(){const[c,E]=i.useState([]),[w,z]=i.useState([]),[R,L]=i.useState(!0),[p,B]=i.useState(""),[t,T]=i.useState(null),[d,y]=i.useState("all"),{toast:j}=$();i.useEffect(()=>{b()},[]),i.useEffect(()=>{H()},[c,p,d]);const b=async()=>{try{const{data:s,error:a}=await A.from("testimonials").select("*").order("created_at",{ascending:!1});if(a)throw a;E(s||[])}catch(s){console.error("Error loading testimonials:",s),j({title:"Error",description:"Failed to load testimonials",variant:"destructive"})}finally{L(!1)}},H=()=>{let s=c;if(p&&(s=s.filter(a=>a.name.toLowerCase().includes(p.toLowerCase())||a.content.toLowerCase().includes(p.toLowerCase()))),d!=="all"){const a=d==="approved";s=s.filter(l=>l.is_approved===a)}z(s)},S=async(s,a)=>{try{const{error:l}=await A.from("testimonials").update({is_approved:!a,updated_at:new Date().toISOString()}).eq("id",s);if(l)throw l;j({title:"Success",description:`Testimonial ${a?"unapproved":"approved"} successfully`}),b()}catch(l){console.error("Error updating testimonial:",l),j({title:"Error",description:"Failed to update testimonial",variant:"destructive"})}},U=async s=>{try{const{error:a}=await A.from("testimonials").delete().eq("id",s);if(a)throw a;j({title:"Success",description:"Testimonial deleted successfully"}),b()}catch(a){console.error("Error deleting testimonial:",a),j({title:"Error",description:"Failed to delete testimonial",variant:"destructive"})}},r=(()=>{const s=c.length,a=c.filter(g=>g.is_approved).length,l=c.filter(g=>!g.is_approved).length,P=c.filter(g=>new Date(g.created_at).getMonth()===new Date().getMonth()).length;return{totalTestimonials:s,approvedTestimonials:a,pendingTestimonials:l,thisMonthTestimonials:P}})();return R?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-church-burgundy"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-church-burgundy",children:"Testimonials Management"}),e.jsx("p",{className:"text-gray-600",children:"Review and manage testimonials from church members"})]})}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsxs(o,{children:[e.jsx(m,{className:"pb-2",children:e.jsxs(x,{className:"text-sm font-medium flex items-center",children:[e.jsx(ce,{className:"w-4 h-4 mr-2"}),"Total Testimonials"]})}),e.jsxs(h,{children:[e.jsx("div",{className:"text-2xl font-bold text-church-burgundy",children:r.totalTestimonials}),e.jsx("p",{className:"text-xs text-gray-500",children:"All time"})]})]}),e.jsxs(o,{children:[e.jsx(m,{className:"pb-2",children:e.jsxs(x,{className:"text-sm font-medium flex items-center",children:[e.jsx(C,{className:"w-4 h-4 mr-2"}),"Approved"]})}),e.jsxs(h,{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:r.approvedTestimonials}),e.jsxs("p",{className:"text-xs text-gray-500",children:[r.totalTestimonials>0?Math.round(r.approvedTestimonials/r.totalTestimonials*100):0,"% of total"]})]})]}),e.jsxs(o,{children:[e.jsx(m,{className:"pb-2",children:e.jsxs(x,{className:"text-sm font-medium flex items-center",children:[e.jsx(D,{className:"w-4 h-4 mr-2"}),"Pending Review"]})}),e.jsxs(h,{children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:r.pendingTestimonials}),e.jsx("p",{className:"text-xs text-gray-500",children:"Awaiting approval"})]})]}),e.jsxs(o,{children:[e.jsx(m,{className:"pb-2",children:e.jsxs(x,{className:"text-sm font-medium flex items-center",children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"This Month"]})}),e.jsxs(h,{children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:r.thisMonthTestimonials}),e.jsx("p",{className:"text-xs text-gray-500",children:"New testimonials"})]})]})]}),e.jsxs(o,{children:[e.jsx(m,{children:e.jsx(x,{className:"text-lg",children:"Search & Filter"})}),e.jsx(h,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"search",children:"Search"}),e.jsxs("div",{className:"relative",children:[e.jsx(de,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(V,{id:"search",placeholder:"Search testimonials...",value:p,onChange:s=>B(s.target.value),className:"pl-10"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{children:"Approval Status"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(n,{variant:d==="all"?"default":"outline",size:"sm",onClick:()=>y("all"),children:"All"}),e.jsx(n,{variant:d==="approved"?"default":"outline",size:"sm",onClick:()=>y("approved"),children:"Approved"}),e.jsx(n,{variant:d==="pending"?"default":"outline",size:"sm",onClick:()=>y("pending"),children:"Pending"})]})]})]})})]}),e.jsxs(o,{children:[e.jsxs(m,{children:[e.jsxs(x,{children:["Testimonials (",w.length,")"]}),e.jsx(W,{children:"Review and manage community testimonials"})]}),e.jsxs(h,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(q,{children:[e.jsx(O,{children:e.jsxs(_,{children:[e.jsx(u,{children:"Date"}),e.jsx(u,{children:"Name"}),e.jsx(u,{children:"Testimonial"}),e.jsx(u,{children:"Status"}),e.jsx(u,{children:"Actions"})]})}),e.jsx(I,{children:w.map(s=>e.jsxs(_,{children:[e.jsx(v,{children:M(new Date(s.created_at),"MMM d, yyyy")}),e.jsx(v,{children:e.jsx("div",{className:"font-medium",children:s.name})}),e.jsx(v,{children:e.jsxs("div",{className:"max-w-xs",children:[e.jsx("p",{className:"truncate",children:s.content}),e.jsx(n,{variant:"link",size:"sm",className:"p-0 h-auto text-xs",onClick:()=>T(s),children:"Read full testimonial"})]})}),e.jsx(v,{children:s.is_approved?e.jsxs(N,{className:"bg-green-100 text-green-800",children:[e.jsx(C,{className:"w-3 h-3 mr-1"}),"Approved"]}):e.jsxs(N,{className:"bg-yellow-100 text-yellow-800",children:[e.jsx(D,{className:"w-3 h-3 mr-1"}),"Pending"]})}),e.jsx(v,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(n,{variant:"outline",size:"sm",onClick:()=>S(s.id,s.is_approved),className:s.is_approved?"":"bg-green-50 hover:bg-green-100",children:s.is_approved?e.jsxs(e.Fragment,{children:[e.jsx(F,{className:"w-3 h-3 mr-1"}),"Unapprove"]}):e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"w-3 h-3 mr-1"}),"Approve"]})}),e.jsxs(Z,{children:[e.jsx(ee,{asChild:!0,children:e.jsx(n,{variant:"destructive",size:"sm",children:e.jsx(oe,{className:"w-3 h-3"})})}),e.jsxs(se,{children:[e.jsxs(ae,{children:[e.jsx(te,{children:"Delete Testimonial"}),e.jsxs(le,{children:["Are you sure you want to delete this testimonial from ",s.name,"? This action cannot be undone."]})]}),e.jsxs(ie,{children:[e.jsx(re,{children:"Cancel"}),e.jsx(ne,{onClick:()=>U(s.id),className:"bg-red-600 hover:bg-red-700",children:"Delete"})]})]})]})]})})]},s.id))})]})}),w.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No testimonials found matching your criteria."})]})]}),e.jsx(Y,{open:!!t,onOpenChange:()=>T(null),children:e.jsxs(G,{className:"max-w-2xl",children:[e.jsxs(K,{children:[e.jsx(Q,{children:"Testimonial Details"}),e.jsx(X,{children:t&&M(new Date(t.created_at),"MMMM d, yyyy 'at' h:mm a")})]}),t&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(f,{className:"text-sm font-medium",children:"From:"}),e.jsx("p",{className:"text-sm font-medium",children:t.name})]}),e.jsxs("div",{children:[e.jsx(f,{className:"text-sm font-medium",children:"Testimonial:"}),e.jsx("div",{className:"mt-2 p-4 bg-gray-50 rounded-md border-l-4 border-church-gold",children:e.jsxs("p",{className:"text-sm leading-relaxed whitespace-pre-wrap italic",children:['"',t.content,'"']})})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(f,{className:"text-sm",children:"Status:"}),t.is_approved?e.jsxs(N,{className:"bg-green-100 text-green-800",children:[e.jsx(C,{className:"w-3 h-3 mr-1"}),"Approved"]}):e.jsxs(N,{className:"bg-yellow-100 text-yellow-800",children:[e.jsx(D,{className:"w-3 h-3 mr-1"}),"Pending Review"]})]}),e.jsx("div",{className:"flex space-x-2",children:e.jsx(n,{variant:"outline",onClick:()=>{S(t.id,t.is_approved),T(null)},className:t.is_approved?"":"bg-green-50 hover:bg-green-100",children:t.is_approved?e.jsxs(e.Fragment,{children:[e.jsx(F,{className:"w-4 h-4 mr-2"}),"Unapprove"]}):e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"w-4 h-4 mr-2"}),"Approve"]})})})]})]})]})})]})}export{Te as default};
