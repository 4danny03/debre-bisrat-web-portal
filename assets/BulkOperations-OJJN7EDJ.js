import{j as e}from"./ui-CIANOcUa.js";import{a as w}from"./vendor-Di3rkBj0.js";import{V as q,x,y as u,z as p,A as j,J as b,W as g,Y as T,a4 as B,O as N,M as L,T as _,l as Y,w as E}from"./index-C4XDO3q4.js";import{T as G,a as K,b as C,c as S}from"./tabs-CjbAmd7P.js";import{A as Q,a as X,b as Z,c as ee,d as se,e as te,f as ae,g as re,h as le}from"./alert-dialog-Co1IkATV.js";import{U as R}from"./upload-DijUUgST.js";import{D}from"./download-vEDD1Lcy.js";import{F as ne}from"./file-text-C90KXjxB.js";function pe(){const[F,k]=w.useState([]),[c,O]=w.useState({subject:"",content:""}),[m,v]=w.useState(""),[P,V]=w.useState("members"),{toast:n}=q(),$=s=>{var o;const t=(o=s.target.files)==null?void 0:o[0];if(!t)return;const r=new FileReader;r.onload=l=>{var i;const a=(i=l.target)==null?void 0:i.result;if(t.type==="application/json")v(a);else if(t.type==="text/csv"){const h=a.split(`
`).filter(d=>d.trim());if(h.length<2)throw new Error("CSV must have at least a header row and one data row");const A=h[0].split(",").map(d=>d.trim()),f=h.slice(1).map(d=>{const y=d.split(","),U={};return A.forEach((z,W)=>{var M;U[z]=((M=y[W])==null?void 0:M.trim())||""}),U}).filter(d=>Object.values(d).some(y=>y&&y!==""));v(JSON.stringify(f,null,2))}},r.readAsText(t)},I=async s=>{if(!m.trim()){n({title:"Error",description:"Please provide data to import",variant:"destructive"});return}try{const t=JSON.parse(m);if(!Array.isArray(t))throw new Error("Data must be an array");if(t.length===0)throw new Error("Data array cannot be empty");const r={id:Date.now().toString(),type:"import",status:"running",progress:0,total:t.length,message:`Importing ${t.length} ${s} records...`,createdAt:new Date};k(a=>[...a,r]);const o=10;let l=0;for(let a=0;a<t.length;a+=o){const i=t.slice(a,a+o),{error:h}=await E.from(s).insert(i);h&&console.error(`Batch ${a/o+1} failed:`,h),l+=i.length,k(A=>A.map(f=>f.id===r.id?{...f,progress:l,message:`Imported ${l}/${t.length} records`}:f))}k(a=>a.map(i=>i.id===r.id?{...i,status:"completed",message:`Successfully imported ${l} records`}:i)),n({title:"Success",description:`Imported ${l} ${s} records`}),v("")}catch(t){console.error("Import error:",t),n({title:"Error",description:"Failed to import data. Please check the format.",variant:"destructive"})}},J=async s=>{try{const{data:t,error:r}=await E.from(s).select("*");if(r)throw r;const o=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),l=URL.createObjectURL(o),a=document.createElement("a");a.href=l,a.download=`${s}-export-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(l),n({title:"Success",description:`Exported ${(t==null?void 0:t.length)||0} ${s} records`})}catch(t){console.error("Export error:",t),n({title:"Error",description:"Failed to export data",variant:"destructive"})}},H=async()=>{if(!c.subject||!c.content){n({title:"Error",description:"Please provide both subject and content",variant:"destructive"});return}try{const{data:s}=await E.from("newsletter_subscribers").select("*").eq("subscribed",!0),t=s||[];if(t.length===0){n({title:"Warning",description:"No active subscribers found",variant:"destructive"});return}const{data:r}=await E.from("email_campaigns").insert({name:`Bulk Email - ${new Date().toLocaleDateString()}`,subject:c.subject,content:c.content,status:"sent",recipient_count:t.length,sent_count:t.length,sent_at:new Date().toISOString()}).select().single();n({title:"Success",description:`Email campaign created and sent to ${t.length} subscribers`}),O({subject:"",content:""})}catch(s){console.error("Bulk email error:",s),n({title:"Error",description:"Failed to send bulk email",variant:"destructive"})}};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-church-burgundy",children:"Bulk Operations"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage data in bulk - import, export, and batch operations"})]})}),e.jsxs(G,{value:P,onValueChange:V,children:[e.jsxs(K,{className:"grid w-full grid-cols-4",children:[e.jsx(C,{value:"members",children:"Members"}),e.jsx(C,{value:"events",children:"Events"}),e.jsx(C,{value:"email",children:"Email Campaign"}),e.jsx(C,{value:"operations",children:"Operations"})]}),e.jsx(S,{value:"members",className:"space-y-6",children:e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs(x,{children:[e.jsxs(u,{children:[e.jsxs(p,{className:"flex items-center",children:[e.jsx(R,{className:"h-5 w-5 mr-2"}),"Import Members"]}),e.jsx(j,{children:"Upload member data from JSON or CSV files"})]}),e.jsxs(b,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"member-file",children:"Upload File"}),e.jsx(T,{id:"member-file",type:"file",accept:".json,.csv",onChange:$})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"member-data",children:"Or Paste JSON Data"}),e.jsx(B,{id:"member-data",placeholder:'[{"full_name": "John Doe", "email": "john@example.com", "phone": "123-456-7890"}]',value:m,onChange:s=>v(s.target.value),rows:8})]}),e.jsx(N,{onClick:()=>I("members"),className:"w-full",disabled:!m.trim(),children:"Import Members"})]})]}),e.jsxs(x,{children:[e.jsxs(u,{children:[e.jsxs(p,{className:"flex items-center",children:[e.jsx(D,{className:"h-5 w-5 mr-2"}),"Export Members"]}),e.jsx(j,{children:"Download all member data as JSON"})]}),e.jsxs(b,{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Export all member records including contact information, membership details, and registration dates."}),e.jsxs(N,{onClick:()=>J("members"),className:"w-full",variant:"outline",children:[e.jsx(D,{className:"h-4 w-4 mr-2"}),"Export All Members"]})]})]})]})}),e.jsx(S,{value:"events",className:"space-y-6",children:e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs(x,{children:[e.jsxs(u,{children:[e.jsxs(p,{className:"flex items-center",children:[e.jsx(R,{className:"h-5 w-5 mr-2"}),"Import Events"]}),e.jsx(j,{children:"Upload event data from JSON or CSV files"})]}),e.jsxs(b,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"event-file",children:"Upload File"}),e.jsx(T,{id:"event-file",type:"file",accept:".json,.csv",onChange:$})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"event-data",children:"Or Paste JSON Data"}),e.jsx(B,{id:"event-data",placeholder:'[{"title": "Sunday Service", "event_date": "2024-01-01", "event_time": "10:00", "location": "Main Hall"}]',value:m,onChange:s=>v(s.target.value),rows:8})]}),e.jsx(N,{onClick:()=>I("events"),className:"w-full",disabled:!m.trim(),children:"Import Events"})]})]}),e.jsxs(x,{children:[e.jsxs(u,{children:[e.jsxs(p,{className:"flex items-center",children:[e.jsx(D,{className:"h-5 w-5 mr-2"}),"Export Events"]}),e.jsx(j,{children:"Download all event data as JSON"})]}),e.jsxs(b,{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Export all event records including dates, times, locations, and descriptions."}),e.jsxs(N,{onClick:()=>J("events"),className:"w-full",variant:"outline",children:[e.jsx(D,{className:"h-4 w-4 mr-2"}),"Export All Events"]})]})]})]})}),e.jsx(S,{value:"email",className:"space-y-6",children:e.jsxs(x,{children:[e.jsxs(u,{children:[e.jsxs(p,{className:"flex items-center",children:[e.jsx(L,{className:"h-5 w-5 mr-2"}),"Bulk Email Campaign"]}),e.jsx(j,{children:"Send emails to all active subscribers"})]}),e.jsxs(b,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"email-subject",children:"Subject"}),e.jsx(T,{id:"email-subject",placeholder:"Enter email subject",value:c.subject,onChange:s=>O(t=>({...t,subject:s.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"email-content",children:"Content"}),e.jsx(B,{id:"email-content",placeholder:"Enter email content...",value:c.content,onChange:s=>O(t=>({...t,content:s.target.value})),rows:10})]}),e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-md p-3",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(_,{className:"h-4 w-4 text-yellow-600 mr-2"}),e.jsx("p",{className:"text-sm text-yellow-800",children:"This will send the email to all active subscribers. Make sure to review the content carefully."})]})}),e.jsxs(Q,{children:[e.jsx(X,{asChild:!0,children:e.jsxs(N,{className:"w-full",disabled:!c.subject||!c.content,children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),"Send Bulk Email"]})}),e.jsxs(Z,{children:[e.jsxs(ee,{children:[e.jsx(se,{children:"Confirm Bulk Email"}),e.jsx(te,{children:"Are you sure you want to send this email to all active subscribers? This action cannot be undone."})]}),e.jsxs(ae,{children:[e.jsx(re,{children:"Cancel"}),e.jsx(le,{onClick:H,children:"Send Email"})]})]})]})]})]})}),e.jsx(S,{value:"operations",className:"space-y-6",children:e.jsxs(x,{children:[e.jsxs(u,{children:[e.jsx(p,{children:"Operation History"}),e.jsx(j,{children:"Track the status of bulk operations"})]}),e.jsx(b,{children:F.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ne,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No operations yet"}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Bulk operations will appear here when you perform them"})]}):e.jsx("div",{className:"space-y-4",children:F.map(s=>e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[s.status==="completed"?e.jsx(Y,{className:"h-5 w-5 text-green-600"}):s.status==="failed"?e.jsx(_,{className:"h-5 w-5 text-red-600"}):e.jsx("div",{className:"h-5 w-5 border-2 border-church-burgundy border-t-transparent rounded-full animate-spin"}),e.jsxs("span",{className:"font-medium capitalize",children:[s.type," Operation"]})]}),e.jsx("span",{className:"text-sm text-gray-500",children:s.createdAt.toLocaleString()})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:s.message}),s.total>0&&e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-church-burgundy h-2 rounded-full transition-all duration-300",style:{width:`${s.progress/s.total*100}%`}})})]},s.id))})})]})})]})]})}export{pe as default};
