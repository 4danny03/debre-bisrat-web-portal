import{j as e}from"./ui-CIANOcUa.js";import{a as p}from"./vendor-Di3rkBj0.js";import{a7 as q,x as j,y as b,z as y,A as g,J as f,W as t,Y as r,a8 as v,a9 as w,aa as N,ab as S,ac as c,l as B,k as T,O as Y}from"./index-C4XDO3q4.js";import{S as m}from"./switch-D3HLDx1l.js";import{T as z,a as H,b as k,c as C}from"./tabs-CjbAmd7P.js";import{n as E}from"./index-BoJfdiDz.js";const F={stripeSettings:{async getSettings(){return{}},async updateSettings(a){return{}}},emailSettings:{async getSettings(){return{}},async updateSettings(a){return{}}},emailSubscribers:{async getSubscribers(){return[]},async deleteSubscriber(a){return{}}},emailTemplates:{async getTemplates(){return[]}}};function D(a){return a.startsWith("pk_test_")||a.startsWith("pk_live_")}function se(){const[a,M]=p.useState({church_name:"",church_address:"",phone_number:"",email:"",admin_email:"",from_email:"noreply@example.com",enable_donations:!0,enable_membership:!0,enable_email_notifications:!0,enable_newsletter:!0,enable_stripe:!1,stripe_publishable_key:"",maintenance_mode:!1}),[u,U]=p.useState({enable_stripe:!1,stripe_mode:"test",stripe_publishable_key:"",stripe_secret_key:"",stripe_webhook_secret:"",default_currency:"USD"}),[o,W]=p.useState({enable_newsletters:!1,from_email:"",from_name:"",newsletter_frequency:"monthly",auto_welcome_email:!1,smtp_host:"",smtp_port:587,smtp_username:"",smtp_password:""}),[V,_]=p.useState("unconfigured");p.useEffect(()=>{R()},[]),p.useEffect(()=>{G()},[a.enable_stripe,a.stripe_publishable_key]);const R=async()=>{try{let{data:s,error:d}=await q.from("site_settings").select("*").limit(1).single();if(d&&d.code==="PGRST116"){const{data:O,error:K}=await q.from("site_settings").insert({id:1,church_name:"St. Gabriel Ethiopian Orthodox Church",church_address:"",phone_number:"",email:"",admin_email:"",from_email:"noreply@example.com",enable_donations:!0,enable_membership:!0,enable_email_notifications:!0,enable_newsletter:!0,enable_stripe:!1,stripe_publishable_key:"",maintenance_mode:!1}).select().single();if(K)throw K;s=O}s&&M(s);const i=await F.stripeSettings.getSettings();let A;i&&typeof i=="object"&&i!==null?A={enable_stripe:"enable_stripe"in i?i.enable_stripe:!1,stripe_mode:"stripe_mode"in i?i.stripe_mode:"test",stripe_publishable_key:"stripe_publishable_key"in i?i.stripe_publishable_key:"",stripe_secret_key:"stripe_secret_key"in i?i.stripe_secret_key:"",stripe_webhook_secret:"stripe_webhook_secret"in i?i.stripe_webhook_secret:"",default_currency:"default_currency"in i?i.default_currency:"USD"}:A={enable_stripe:!1,stripe_mode:"test",stripe_publishable_key:"",stripe_secret_key:"",stripe_webhook_secret:"",default_currency:"USD"},U(A);const l=await F.emailSettings.getSettings();let P;l&&typeof l=="object"&&l!==null?P={enable_newsletters:"enable_newsletters"in l?l.enable_newsletters:!1,from_email:"from_email"in l?l.from_email:"",from_name:"from_name"in l?l.from_name:"",newsletter_frequency:"newsletter_frequency"in l?l.newsletter_frequency:"monthly",auto_welcome_email:"auto_welcome_email"in l?l.auto_welcome_email:!1,smtp_host:"smtp_host"in l?l.smtp_host:"",smtp_port:"smtp_port"in l?l.smtp_port:587,smtp_username:"smtp_username"in l?l.smtp_username:"",smtp_password:"smtp_password"in l?l.smtp_password:""}:P={enable_newsletters:!1,from_email:"",from_name:"",newsletter_frequency:"monthly",auto_welcome_email:!1,smtp_host:"",smtp_port:587,smtp_username:"",smtp_password:""},W(P),G()}catch(s){console.error("Error loading settings:",s),E.error("Failed to load settings data")}},G=()=>{if(!a.enable_stripe){_("unconfigured");return}const s=a.stripe_publishable_key.trim();s===""?_("unconfigured"):D(s)?_("configured"):_("testing")},n=(s,d)=>{M(i=>({...i,[s]:d}))},x=(s,d)=>{U(i=>({...i,[s]:d}))},h=(s,d)=>{W(i=>({...i,[s]:d}))},L=async s=>{if(s.preventDefault(),a.enable_stripe&&!D(a.stripe_publishable_key)){E.error("Please enter a valid Stripe publishable key.");return}try{await q.from("site_settings").upsert([{id:1,...a}]).select(),await F.stripeSettings.updateSettings(u),await F.emailSettings.updateSettings(o),E.success("Your settings have been updated successfully")}catch(d){console.error("Error saving settings:",d),E.error("Failed to save settings data")}},I=()=>{switch(V){case"configured":return e.jsx("span",{className:"inline-flex items-center px-2 py-1 text-xs font-medium text-green-800 bg-green-100 rounded-full",children:"Configured"});case"testing":return e.jsx("span",{className:"inline-flex items-center px-2 py-1 text-xs font-medium text-yellow-800 bg-yellow-100 rounded-full",children:"Test Mode"});case"unconfigured":default:return e.jsx("span",{className:"inline-flex items-center px-2 py-1 text-xs font-medium text-red-800 bg-red-100 rounded-full",children:"Unconfigured"})}};return e.jsx("div",{className:"max-w-4xl mx-auto py-10",children:e.jsxs("form",{onSubmit:L,children:[e.jsxs(z,{defaultValue:"general",className:"space-y-6",children:[e.jsxs(H,{children:[e.jsx(k,{value:"general",children:"General"}),e.jsx(k,{value:"email",children:"Email Settings"}),e.jsx(k,{value:"payments",children:"Payment Settings"}),e.jsx(k,{value:"features",children:"Features"})]}),e.jsx(C,{value:"general",children:e.jsxs(j,{children:[e.jsxs(b,{children:[e.jsx(y,{children:"General Settings"}),e.jsx(g,{children:"Configure basic church information"})]}),e.jsxs(f,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"churchName",children:"Church Name"}),e.jsx(r,{id:"churchName",value:a.church_name,onChange:s=>n("church_name",s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"address",children:"Address"}),e.jsx(r,{id:"address",value:a.church_address,onChange:s=>n("church_address",s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"phone",children:"Phone Number"}),e.jsx(r,{id:"phone",value:a.phone_number,onChange:s=>n("phone_number",s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"email",children:"Public Email"}),e.jsx(r,{id:"email",type:"email",value:a.email,onChange:s=>n("email",s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"adminEmail",children:"Admin Email"}),e.jsx(r,{id:"adminEmail",type:"email",value:a.admin_email,onChange:s=>n("admin_email",s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"fromEmail",children:"From Email"}),e.jsx(r,{id:"fromEmail",type:"email",value:a.from_email,onChange:s=>n("from_email",s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"newsletterFreq",children:"Newsletter Frequency"}),e.jsxs(v,{value:o.newsletter_frequency,onValueChange:s=>h("newsletter_frequency",s),children:[e.jsx(w,{children:e.jsx(N,{})}),e.jsxs(S,{children:[e.jsx(c,{value:"daily",children:"Daily"}),e.jsx(c,{value:"weekly",children:"Weekly"}),e.jsx(c,{value:"monthly",children:"Monthly"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(t,{children:"Enable Newsletter System"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Allow newsletter subscriptions and campaigns"})]}),e.jsx(m,{checked:o.enable_newsletters,onCheckedChange:s=>h("enable_newsletters",s)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(t,{children:"Auto Welcome Email"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Send welcome email to new subscribers"})]}),e.jsx(m,{checked:o.auto_welcome_email,onCheckedChange:s=>h("auto_welcome_email",s)})]})]})]})}),e.jsx(C,{value:"email",children:e.jsxs(j,{children:[e.jsxs(b,{children:[e.jsx(y,{children:"Email Configuration"}),e.jsx(g,{children:"Configure email settings for notifications and newsletters"})]}),e.jsxs(f,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"adminEmail",children:"Admin Email"}),e.jsx(r,{id:"adminEmail",type:"email",value:a.admin_email,onChange:s=>n("admin_email",s.target.value),placeholder:"admin@church.com"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Email to receive admin notifications"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"fromEmail",children:"From Email"}),e.jsx(r,{id:"fromEmail",type:"email",value:o.from_email,onChange:s=>h("from_email",s.target.value),placeholder:"noreply@church.org"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"fromName",children:"From Name"}),e.jsx(r,{id:"fromName",value:o.from_name,onChange:s=>h("from_name",s.target.value),placeholder:"St. Gabriel Church"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"newsletterFreq",children:"Newsletter Frequency"}),e.jsxs(v,{value:o.newsletter_frequency,onValueChange:s=>h("newsletter_frequency",s),children:[e.jsx(w,{children:e.jsx(N,{})}),e.jsxs(S,{children:[e.jsx(c,{value:"daily",children:"Daily"}),e.jsx(c,{value:"weekly",children:"Weekly"}),e.jsx(c,{value:"monthly",children:"Monthly"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(t,{children:"Auto Welcome Email"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Send welcome email to new subscribers"})]}),e.jsx(m,{checked:o.auto_welcome_email,onCheckedChange:s=>h("auto_welcome_email",s)})]})]})]})}),e.jsx(C,{value:"payments",children:e.jsxs(j,{children:[e.jsxs(b,{children:[e.jsxs(y,{className:"flex items-center justify-between",children:["Payment Settings",I()]}),e.jsx(g,{children:"Configure Stripe payment integration for donations and membership"})]}),e.jsxs(f,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(t,{children:"Enable Stripe Payments"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Allow online donations and membership payments via Stripe"}),e.jsx(t,{children:"Auto Welcome Email"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Send welcome email to new subscribers"})]}),e.jsx(m,{checked:a.enable_stripe,onCheckedChange:s=>n("enable_stripe",s)})]}),a.enable_stripe&&e.jsxs("div",{className:"space-y-4 p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"stripeMode",children:"Stripe Mode"}),e.jsxs(v,{value:u.stripe_mode,onValueChange:s=>x("stripe_mode",s),children:[e.jsx(w,{children:e.jsx(N,{})}),e.jsxs(S,{children:[e.jsx(c,{value:"test",children:"Test"}),e.jsx(c,{value:"live",children:"Live"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"currency",children:"Default Currency"}),e.jsxs(v,{value:u.default_currency,onValueChange:s=>x("default_currency",s),children:[e.jsx(w,{children:e.jsx(N,{})}),e.jsxs(S,{children:[e.jsx(c,{value:"USD",children:"USD - US Dollar"}),e.jsx(c,{value:"EUR",children:"EUR - Euro"}),e.jsx(c,{value:"GBP",children:"GBP - British Pound"}),e.jsx(c,{value:"CAD",children:"CAD - Canadian Dollar"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"publishableKey",children:"Stripe Publishable Key"}),e.jsx(r,{id:"publishableKey",type:"password",value:u.stripe_publishable_key,onChange:s=>x("stripe_publishable_key",s.target.value),placeholder:"pk_test_..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"secretKey",children:"Stripe Secret Key"}),e.jsx(r,{id:"secretKey",type:"password",value:u.stripe_secret_key,onChange:s=>x("stripe_secret_key",s.target.value),placeholder:"sk_test_..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"webhookSecret",children:"Stripe Webhook Secret"}),e.jsx(r,{id:"webhookSecret",type:"password",value:u.stripe_webhook_secret,onChange:s=>x("stripe_webhook_secret",s.target.value),placeholder:"whsec_..."})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(t,{children:"Enable Donations"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Allow visitors to make donations"})]}),e.jsx(m,{checked:a.enable_donations,onCheckedChange:s=>n("enable_donations",s)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(t,{children:"Enable Membership"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Allow visitors to register for membership"})]}),e.jsx(m,{checked:a.enable_membership,onCheckedChange:s=>n("enable_membership",s)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(t,{children:"Maintenance Mode"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Put the website in maintenance mode"})]}),e.jsx(m,{checked:a.maintenance_mode,onCheckedChange:s=>n("maintenance_mode",s)})]}),e.jsxs("div",{className:"bg-blue-50 p-3 rounded border border-blue-200",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"Stripe Configuration Status"}),e.jsxs("ul",{className:"space-y-1 text-sm text-blue-800",children:[e.jsxs("li",{className:"flex items-center",children:[a.enable_stripe?e.jsx(B,{className:"w-4 h-4 mr-2 text-green-600"}):e.jsx(T,{className:"w-4 h-4 mr-2 text-red-600"}),"Stripe integration"," ",a.enable_stripe?"enabled":"disabled"]}),e.jsxs("li",{className:"flex items-center",children:[a.stripe_publishable_key&&D(a.stripe_publishable_key)?e.jsx(B,{className:"w-4 h-4 mr-2 text-green-600"}):e.jsx(T,{className:"w-4 h-4 mr-2 text-red-600"}),"Publishable key"," ",a.stripe_publishable_key&&D(a.stripe_publishable_key)?"configured":"missing or invalid"]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx(T,{className:"w-4 h-4 mr-2 text-orange-600"}),"Secret key must be configured in Supabase Edge Function secrets"]})]})]})]})]})]})}),e.jsx(C,{value:"features",children:e.jsxs(j,{children:[e.jsxs(b,{children:[e.jsx(y,{children:"Feature Settings"}),e.jsx(g,{children:"Enable or disable website features"})]}),e.jsxs(f,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(t,{children:"Enable Donations"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Allow visitors to make donations"})]}),e.jsx(m,{checked:a.enable_donations,onCheckedChange:s=>n("enable_donations",s)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(t,{children:"Enable Membership"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Allow visitors to register for membership"})]}),e.jsx(m,{checked:a.enable_membership,onCheckedChange:s=>n("enable_membership",s)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(t,{children:"Enable Email Notifications"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Send email notifications to admin"})]}),e.jsx(m,{checked:a.enable_email_notifications,onCheckedChange:s=>n("enable_email_notifications",s)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(t,{children:"Enable Newsletter"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Allow newsletter subscriptions"})]}),e.jsx(m,{checked:a.enable_newsletter,onCheckedChange:s=>n("enable_newsletter",s)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(t,{children:"Maintenance Mode"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Put the website in maintenance mode"})]}),e.jsx(m,{checked:a.maintenance_mode,onCheckedChange:s=>n("maintenance_mode",s)})]})]})]})})]}),e.jsx("div",{className:"mt-6",children:e.jsx(Y,{type:"submit",children:"Save Settings"})})]})})}export{se as default};
