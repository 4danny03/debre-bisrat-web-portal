import{j as e}from"./ui-CIANOcUa.js";import{a as o,i as b}from"./vendor-Di3rkBj0.js";import{x as E,y as S,z as F,A as R,J as k,W as n,Y as l,O as C,w as d}from"./index-C4XDO3q4.js";import{n as a}from"./index-BoJfdiDz.js";function W(){const[u,j]=o.useState({}),[B,N]=o.useState(!0),[I,O]=o.useState(!1),[m,c]=o.useState(!1),[p,f]=o.useState(""),[i,w]=o.useState(""),[h,x]=o.useState(""),y=b();return o.useEffect(()=>{(async()=>{try{const{data:{session:r}}=await d.auth.getSession();if(!r){y("/admin/login");return}const{data:g,error:t}=await d.from("profiles").select("id, email, role").eq("id",r.user.id).single();if(t&&t.code!=="PGRST116"&&console.error("Error fetching profile:",t),g)j(g);else{const P={id:r.user.id,email:r.user.email,role:"admin"},{error:v}=await d.from("profiles").insert(P);v&&console.error("Error creating profile:",v),j(P)}}catch(r){console.error(r),a.error("Failed to load profile")}finally{N(!1)}})()},[y]),e.jsxs("div",{role:"main",className:"max-w-3xl mx-auto",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-church-burgundy mb-2",children:"My Profile"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"View and update your admin profile information"}),e.jsxs(E,{children:[e.jsxs(S,{children:[e.jsx(F,{children:"Profile"}),e.jsx(R,{children:"Basic account details"})]}),e.jsxs(k,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"email",children:"Email (read-only)"}),e.jsx(l,{id:"email",value:u.email||"",readOnly:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Role"}),e.jsx(l,{value:u.role||"admin",readOnly:!0})]}),e.jsxs("div",{className:"pt-4",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Change Password"}),e.jsx("p",{className:"text-sm text-gray-500 mb-3",children:"Update your account password. You will be asked to confirm your current password."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"currentPassword",children:"Current password"}),e.jsx(l,{id:"currentPassword",type:"password",value:p,onChange:s=>f(s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"newPassword",children:"New password"}),e.jsx(l,{id:"newPassword",type:"password",value:i,onChange:s=>w(s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"confirmPassword",children:"Confirm new password"}),e.jsx(l,{id:"confirmPassword",type:"password",value:h,onChange:s=>x(s.target.value)})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-2 mt-3",children:[e.jsx(C,{variant:"outline",onClick:()=>{f(""),w(""),x("")},disabled:m,children:"Reset"}),e.jsx(C,{onClick:async()=>{if(!p||!i||!h){a.error("Please fill all password fields");return}if(i.length<8){a.error("New password must be at least 8 characters");return}if(i!==h){a.error("New password and confirmation do not match");return}c(!0);try{const s=u.email;if(!s){a.error("No email available for re-authentication"),c(!1);return}const{error:r}=await d.auth.signInWithPassword({email:s,password:p});if(r){console.error("Re-auth error:",r),a.error("Current password is incorrect"),c(!1);return}const{data:g,error:t}=await d.auth.updateUser({password:i});t?(console.error("Error updating password:",t),a.error("Failed to update password")):(a.success("Password updated successfully"),f(""),w(""),x(""))}catch(s){console.error(s),a.error("Failed to update password")}finally{c(!1)}},disabled:m,children:m?"Updating...":"Change password"})]})]})]})]})]})}export{W as default};
