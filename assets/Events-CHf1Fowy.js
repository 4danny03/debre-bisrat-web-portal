import{j as e}from"./ui-CIANOcUa.js";import{a as n}from"./vendor-Di3rkBj0.js";import{T as te,a as ae,b as O,c as v,d as ie,e as f}from"./table-CcA4TWxd.js";import{V as K,w as u,L as Q,$,a0 as re,O as _,a1 as H,a2 as z,a3 as B,W as a,Y as r,a4 as J,x as F,y as D,z as S,J as T,A as le,I as ne,a5 as W,C as de,m as ce,u as oe,a6 as me}from"./index-C4XDO3q4.js";import{A as xe,a as he,b as ue,c as je,d as ge,e as pe,f as ve,g as fe,h as _e}from"./alert-dialog-Co1IkATV.js";import{B as Y}from"./badge-Befivxqe.js";import{S as R}from"./switch-D3HLDx1l.js";import{P as ye}from"./plus-CeiqPXVg.js";import{S as Ne}from"./search-BOIwQ3kk.js";import{T as we}from"./tag-BNGEV5UG.js";import{S as Ee}from"./square-pen-D4gMYDLN.js";import{T as be}from"./trash-2-DlTU7m4C.js";import{U as Ce}from"./upload-DijUUgST.js";const G=({onFileUpload:j,defaultImageUrl:w,onRemove:E})=>{const[y,q]=n.useState(null),[N,h]=n.useState(!1),[I,A]=n.useState(0),[b,i]=n.useState(w||null),{toast:g}=K(),C=c=>{if(c.target.files&&c.target.files[0]){const d=c.target.files[0];q(d);const o=URL.createObjectURL(d);i(o)}},p=async()=>{if(!y){g({title:"No file selected",description:"Please select a file to upload",variant:"destructive"});return}h(!0),A(0);try{const c=y.name.split(".").pop(),o=`events/${`${Math.random().toString(36).substring(2,15)}_${Date.now()}.${c}`}`,{error:L}=await u.storage.from("events").upload(o,y);if(L)throw L;A(100);const{data:{publicUrl:P}}=u.storage.from("events").getPublicUrl(o);j(P),g({title:"Upload successful",description:"Image has been uploaded successfully"})}catch(c){console.error("Error uploading file:",c),g({title:"Upload failed",description:c instanceof Error?c.message:"Upload failed",variant:"destructive"})}finally{h(!1)}},U=()=>{q(null),i(null),E&&E()};return n.useEffect(()=>{w&&i(w)},[w]),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(r,{type:"file",accept:"image/*",onChange:C,disabled:N}),b&&e.jsx(_,{type:"button",onClick:U,variant:"destructive",size:"sm",children:"Remove"}),e.jsx(_,{type:"button",onClick:p,disabled:!y||N,variant:"secondary",children:N?e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"mr-2 h-4 w-4 animate-spin"}),"Uploading..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ce,{className:"mr-2 h-4 w-4"}),"Upload"]})})]}),N&&e.jsx(me,{value:I,className:"h-2"}),b&&e.jsxs("div",{className:"mt-4",children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"Preview:"}),e.jsx("div",{className:"relative w-full h-48 bg-gray-100 rounded-md overflow-hidden",children:e.jsx("img",{src:b,alt:"Preview",className:"w-full h-full object-cover"})})]})]})};function Ve(){var k,M,V;const[j,w]=n.useState([]),[E,y]=n.useState([]),[q,N]=n.useState(!0),[h,I]=n.useState(""),[A,b]=n.useState(!1),[i,g]=n.useState(null),[C,p]=n.useState(null),[U,c]=n.useState(null),{toast:d}=K(),o=n.useCallback(async()=>{try{N(!0);const{data:s,error:l}=await u.from("events").select("*").order("event_date",{ascending:!1});if(l)throw l;w(s||[]),y(s||[])}catch(s){console.error("Error loading events:",s),d({title:"Error",description:"Failed to load events",variant:"destructive"})}finally{N(!1)}},[d]);n.useEffect(()=>{o()},[o]),n.useEffect(()=>{const s=j.filter(l=>{var t,m,x;return l.title.toLowerCase().includes(h.toLowerCase())||((t=l.description)==null?void 0:t.toLowerCase().includes(h.toLowerCase()))||((m=l.location)==null?void 0:m.toLowerCase().includes(h.toLowerCase()))||((x=l.category)==null?void 0:x.toLowerCase().includes(h.toLowerCase()))});y(s)},[h,j]);const L=n.useCallback(async s=>{s.preventDefault();const l=s.target,t=new FormData(l),m=(await u.auth.getUser()).data.user;try{const{error:x}=await u.from("events").insert([{title:t.get("title"),description:t.get("description"),event_date:t.get("event_date"),event_time:t.get("event_time")||null,end_date:t.get("end_date")||null,end_time:t.get("end_time")||null,location:t.get("location")||null,category:t.get("category")||null,max_attendees:t.get("max_attendees")?parseInt(t.get("max_attendees")):null,registration_required:t.get("registration_required")==="on",registration_deadline:t.get("registration_deadline")||null,featured:t.get("featured")==="on",image_url:C,created_by:(m==null?void 0:m.id)||null}]);if(x)throw x;d({title:"Success",description:"Event added successfully"}),o(),b(!1),p(null),l.reset()}catch(x){console.error("Error adding event:",x),d({title:"Error",description:"Failed to add event",variant:"destructive"})}},[C,d,o]),P=n.useCallback(async s=>{if(s.preventDefault(),!i)return;const l=s.target,t=new FormData(l);try{const m=C||U,{error:x}=await u.from("events").update({title:t.get("title"),description:t.get("description"),event_date:t.get("event_date"),event_time:t.get("event_time")||null,end_date:t.get("end_date")||null,end_time:t.get("end_time")||null,location:t.get("location")||null,category:t.get("category")||null,max_attendees:t.get("max_attendees")?parseInt(t.get("max_attendees")):null,registration_required:t.get("registration_required")==="on",registration_deadline:t.get("registration_deadline")||null,featured:t.get("featured")==="on",image_url:m,updated_at:new Date().toISOString()}).eq("id",i.id);if(x)throw x;d({title:"Success",description:"Event updated successfully"}),o(),g(null),p(null),c(null)}catch(m){console.error("Error updating event:",m),d({title:"Error",description:"Failed to update event",variant:"destructive"})}},[i,C,U,d,o]),X=n.useCallback(async s=>{try{const{data:l,error:t}=await u.from("events").select("image_url").eq("id",s).single();if(t)throw t;if(l!=null&&l.image_url){const x=l.image_url.split("/"),se=x.slice(x.indexOf("events")).join("/");await u.storage.from("events").remove([se])}const{error:m}=await u.from("events").delete().eq("id",s);if(m)throw m;d({title:"Success",description:"Event deleted successfully"}),o()}catch(l){console.error("Error deleting event:",l),d({title:"Error",description:"Failed to delete event",variant:"destructive"})}},[d,o]),Z=s=>{g(s),c(s.image_url),p(null)},ee=()=>{p(null),c(null)};return q?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(Q,{className:"h-8 w-8 animate-spin text-church-burgundy"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Events Management"}),e.jsx("p",{className:"text-gray-600",children:"Manage all church events"})]}),e.jsxs($,{open:A,onOpenChange:b,children:[e.jsx(re,{asChild:!0,children:e.jsxs(_,{children:[e.jsx(ye,{className:"w-4 h-4 mr-2"}),"Add Event"]})}),e.jsxs(H,{className:"max-w-2xl overflow-y-auto max-h-screen",children:[e.jsx(z,{children:e.jsx(B,{children:"Add New Event"})}),e.jsxs("form",{onSubmit:L,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{htmlFor:"title",children:"Event Title*"}),e.jsx(r,{id:"title",name:"title",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{htmlFor:"description",children:"Description"}),e.jsx(J,{id:"description",name:"description",rows:3})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{htmlFor:"event_date",children:"Start Date*"}),e.jsx(r,{id:"event_date",name:"event_date",type:"date",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{htmlFor:"event_time",children:"Start Time"}),e.jsx(r,{id:"event_time",name:"event_time",type:"time"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{htmlFor:"end_date",children:"End Date"}),e.jsx(r,{id:"end_date",name:"end_date",type:"date"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{htmlFor:"end_time",children:"End Time"}),e.jsx(r,{id:"end_time",name:"end_time",type:"time"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{htmlFor:"location",children:"Location"}),e.jsx(r,{id:"location",name:"location"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{htmlFor:"category",children:"Category"}),e.jsx(r,{id:"category",name:"category"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{htmlFor:"max_attendees",children:"Max Attendees"}),e.jsx(r,{id:"max_attendees",name:"max_attendees",type:"number",min:"0"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{htmlFor:"registration_deadline",children:"Registration Deadline"}),e.jsx(r,{id:"registration_deadline",name:"registration_deadline",type:"date"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{children:"Event Image"}),e.jsx(G,{onFileUpload:p})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(R,{id:"registration_required",name:"registration_required"}),e.jsx(a,{htmlFor:"registration_required",children:"Registration Required"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(R,{id:"featured",name:"featured"}),e.jsx(a,{htmlFor:"featured",children:"Featured Event"})]})]}),e.jsx(_,{type:"submit",className:"w-full",children:"Add Event"})]})]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsxs(F,{children:[e.jsx(D,{className:"pb-2",children:e.jsx(S,{className:"text-sm font-medium",children:"Total Events"})}),e.jsx(T,{children:e.jsx("div",{className:"text-2xl font-bold",children:j.length})})]}),e.jsxs(F,{children:[e.jsx(D,{className:"pb-2",children:e.jsx(S,{className:"text-sm font-medium",children:"Featured Events"})}),e.jsx(T,{children:e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:j.filter(s=>s.featured).length})})]}),e.jsxs(F,{children:[e.jsx(D,{className:"pb-2",children:e.jsx(S,{className:"text-sm font-medium",children:"Upcoming Events"})}),e.jsx(T,{children:e.jsx("div",{className:"text-2xl font-bold text-green-600",children:j.filter(s=>new Date(s.event_date)>=new Date).length})})]}),e.jsxs(F,{children:[e.jsx(D,{className:"pb-2",children:e.jsx(S,{className:"text-sm font-medium",children:"Require Registration"})}),e.jsx(T,{children:e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:j.filter(s=>s.registration_required).length})})]})]}),e.jsxs(F,{children:[e.jsx(D,{children:e.jsx(S,{className:"text-lg",children:"Search Events"})}),e.jsx(T,{children:e.jsxs("div",{className:"relative",children:[e.jsx(Ne,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(r,{placeholder:"Search events by title, description, location, or category...",value:h,onChange:s=>I(s.target.value),className:"pl-10"})]})})]}),e.jsxs(F,{children:[e.jsxs(D,{children:[e.jsxs(S,{children:["All Events (",E.length,")"]}),e.jsx(le,{children:"Manage your church events"})]}),e.jsxs(T,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(te,{children:[e.jsx(ae,{children:e.jsxs(O,{children:[e.jsx(v,{children:"Image"}),e.jsx(v,{children:"Title"}),e.jsx(v,{children:"Date & Time"}),e.jsx(v,{children:"Location"}),e.jsx(v,{children:"Category"}),e.jsx(v,{children:"Registration"}),e.jsx(v,{children:"Featured"}),e.jsx(v,{children:"Actions"})]})}),e.jsx(ie,{children:E.map(s=>e.jsxs(O,{children:[e.jsx(f,{children:s.image_url?e.jsx("div",{className:"w-16 h-16 rounded-md overflow-hidden",children:e.jsx("img",{src:s.image_url,alt:s.title,className:"w-full h-full object-cover"})}):e.jsx("div",{className:"w-16 h-16 rounded-md bg-gray-100 flex items-center justify-center",children:e.jsx(ne,{className:"w-6 h-6 text-gray-400"})})}),e.jsxs(f,{className:"font-medium",children:[e.jsx("div",{children:s.title}),s.description&&e.jsx("div",{className:"text-sm text-gray-500 line-clamp-1",children:s.description})]}),e.jsxs(f,{children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(de,{className:"w-4 h-4 mr-2"}),W(new Date(s.event_date),"MMM d, yyyy"),s.event_time&&e.jsxs(e.Fragment,{children:[e.jsx(ce,{className:"w-4 h-4 ml-3 mr-2"}),s.event_time.substring(0,5)]})]}),s.end_date&&e.jsxs("div",{className:"text-sm mt-1",children:["Ends: ",W(new Date(s.end_date),"MMM d, yyyy"),s.end_time&&` at ${s.end_time.substring(0,5)}`]})]}),e.jsx(f,{children:s.location||"-"}),e.jsx(f,{children:s.category?e.jsxs(Y,{variant:"outline",children:[e.jsx(we,{className:"w-3 h-3 mr-1"}),s.category]}):"-"}),e.jsx(f,{children:s.registration_required?e.jsxs("div",{className:"flex items-center",children:[e.jsx(oe,{className:"w-4 h-4 mr-2"}),s.max_attendees?`${s.max_attendees} max`:"Required"]}):"Not required"}),e.jsx(f,{children:s.featured?e.jsx(Y,{variant:"secondary",children:"Featured"}):"-"}),e.jsx(f,{children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(_,{variant:"outline",size:"sm",onClick:()=>Z(s),children:e.jsx(Ee,{className:"w-4 h-4"})}),e.jsxs(xe,{children:[e.jsx(he,{asChild:!0,children:e.jsx(_,{variant:"destructive",size:"sm",children:e.jsx(be,{className:"w-4 h-4"})})}),e.jsxs(ue,{children:[e.jsxs(je,{children:[e.jsx(ge,{children:"Confirm Deletion"}),e.jsxs(pe,{children:['Are you sure you want to delete "',s.title,'"? This action cannot be undone.']})]}),e.jsxs(ve,{children:[e.jsx(fe,{children:"Cancel"}),e.jsx(_e,{onClick:()=>X(s.id),className:"bg-red-600 hover:bg-red-700",children:"Delete"})]})]})]})]})})]},s.id))})]})}),E.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No events found matching your criteria"})]})]}),e.jsx($,{open:!!i,onOpenChange:()=>g(null),children:e.jsxs(H,{className:"max-w-2xl overflow-y-auto max-h-screen",children:[e.jsx(z,{children:e.jsx(B,{children:"Edit Event"})}),i&&e.jsxs("form",{onSubmit:P,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{htmlFor:"edit_title",children:"Event Title*"}),e.jsx(r,{id:"edit_title",name:"title",defaultValue:i.title,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{htmlFor:"edit_description",children:"Description"}),e.jsx(J,{id:"edit_description",name:"description",defaultValue:i.description||"",rows:3})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{htmlFor:"edit_event_date",children:"Start Date*"}),e.jsx(r,{id:"edit_event_date",name:"event_date",type:"date",defaultValue:i.event_date.split("T")[0],required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{htmlFor:"edit_event_time",children:"Start Time"}),e.jsx(r,{id:"edit_event_time",name:"event_time",type:"time",defaultValue:i.event_time||""})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{htmlFor:"edit_end_date",children:"End Date"}),e.jsx(r,{id:"edit_end_date",name:"end_date",type:"date",defaultValue:((k=i.end_date)==null?void 0:k.split("T")[0])||""})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{htmlFor:"edit_end_time",children:"End Time"}),e.jsx(r,{id:"edit_end_time",name:"end_time",type:"time",defaultValue:i.end_time||""})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{htmlFor:"edit_location",children:"Location"}),e.jsx(r,{id:"edit_location",name:"location",defaultValue:i.location||""})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{htmlFor:"edit_category",children:"Category"}),e.jsx(r,{id:"edit_category",name:"category",defaultValue:i.category||""})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{htmlFor:"edit_max_attendees",children:"Max Attendees"}),e.jsx(r,{id:"edit_max_attendees",name:"max_attendees",type:"number",min:"0",defaultValue:((M=i.max_attendees)==null?void 0:M.toString())||""})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{htmlFor:"edit_registration_deadline",children:"Registration Deadline"}),e.jsx(r,{id:"edit_registration_deadline",name:"registration_deadline",type:"date",defaultValue:((V=i.registration_deadline)==null?void 0:V.split("T")[0])||""})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{children:"Event Image"}),e.jsx(G,{onFileUpload:p,defaultImageUrl:U,onRemove:ee})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(R,{id:"edit_registration_required",name:"registration_required",defaultChecked:i.registration_required}),e.jsx(a,{htmlFor:"edit_registration_required",children:"Registration Required"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(R,{id:"edit_featured",name:"featured",defaultChecked:i.featured}),e.jsx(a,{htmlFor:"edit_featured",children:"Featured Event"})]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(_,{type:"submit",className:"flex-1",children:"Update Event"}),e.jsx(_,{type:"button",variant:"outline",onClick:()=>g(null),children:"Cancel"})]})]})]})})]})}export{Ve as default};
