import{j as e}from"./ui-BKKtghGE.js";import{a}from"./vendor-DsXQwQzb.js";import{V as C,w as c,$ as U,a0 as S,O as g,a1 as T,a2 as F,a3 as P,Y as u,x as k,J as _}from"./index-BzL-sfoN.js";import{I as $}from"./image-plus-BBwDSPpB.js";import{T as q}from"./trash-2-COsc09J2.js";function B(){const[v,w]=a.useState([]),[b,E]=a.useState(!0),[f,p]=a.useState(!1),{toast:t}=C(),i=a.useCallback(async()=>{try{const{data:r,error:s}=await c.from("gallery").select("*").order("created_at",{ascending:!1});if(s)throw s;w(r||[])}catch(r){console.error("Error loading images:",r),t({title:"Error",description:"Failed to load gallery images",variant:"destructive"})}finally{E(!1)}},[t]);a.useEffect(()=>{i()},[i]);const N=a.useCallback(async r=>{r.preventDefault();const s=r.target,l=new FormData(s),o=l.get("file"),n=l.get("title"),D=l.get("description");if(o){p(!0);try{const d=o.name.split(".").pop(),h=`gallery/${Date.now()}.${d}`,{error:x}=await c.storage.from("images").upload(h,o);if(x)throw x;const{data:m}=c.storage.from("images").getPublicUrl(h),j=m==null?void 0:m.publicUrl;if(!j)throw new Error("Failed to get public URL for image");const{error:y}=await c.from("gallery").insert([{title:n,description:D,image_url:j}]);if(y)throw y;t({title:"Success",description:"Image uploaded successfully"}),i(),s.reset()}catch(d){console.error("Error uploading image:",d),t({title:"Error",description:"Failed to upload image",variant:"destructive"})}finally{p(!1)}}},[t,i]),I=a.useCallback(async r=>{try{const s=r.image_url.split("/"),l=`gallery/${s[s.length-1]}`;if(l){const{error:n}=await c.storage.from("images").remove([l]);n&&console.warn("Storage deletion failed:",n)}const{error:o}=await c.from("gallery").delete().eq("id",r.id);if(o)throw o;t({title:"Success",description:"Image deleted successfully"}),i()}catch(s){console.error("Error deleting image:",s),t({title:"Error",description:"Failed to delete image",variant:"destructive"})}},[t,i]);return b?e.jsx("div",{children:"Loading..."}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Gallery"}),e.jsxs(U,{children:[e.jsx(S,{asChild:!0,children:e.jsxs(g,{children:[e.jsx($,{className:"w-4 h-4 mr-2"}),"Add Image"]})}),e.jsxs(T,{children:[e.jsx(F,{children:e.jsx(P,{children:"Upload Image"})}),e.jsxs("form",{onSubmit:N,className:"space-y-4",children:[e.jsx("div",{children:e.jsx(u,{type:"file",name:"file",accept:"image/*",required:!0})}),e.jsx("div",{children:e.jsx(u,{name:"title",placeholder:"Image Title",required:!0})}),e.jsx("div",{children:e.jsx(u,{name:"description",placeholder:"Image Description"})}),e.jsx(g,{type:"submit",disabled:f,children:f?"Uploading...":"Upload"})]})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:v.map(r=>e.jsx(k,{children:e.jsxs(_,{className:"p-4",children:[e.jsx("div",{className:"aspect-w-16 aspect-h-9 mb-4",children:e.jsx("img",{src:r.image_url,alt:r.title,className:"object-cover rounded-lg w-full h-48"})}),e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:r.title}),r.description&&e.jsx("p",{className:"text-sm text-gray-500",children:r.description})]}),e.jsx(g,{variant:"destructive",size:"icon",onClick:()=>I(r),children:e.jsx(q,{className:"w-4 h-4"})})]})]})},r.id))})]})}export{B as default};
