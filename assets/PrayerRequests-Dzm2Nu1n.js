import{j as e}from"./ui-CIANOcUa.js";import{a as n}from"./vendor-Di3rkBj0.js";import{T as se,a as ae,b as z,c as f,d as re,e as w}from"./table-CcA4TWxd.js";import{V as te,w as S,ad as le,x as h,y as u,z as j,J as g,l as v,m as C,C as ie,W as d,Y as O,O as l,A as ne,a5 as H,M as P,$ as B,a1 as V,a2 as W,a3 as I,ae as $,a4 as ce}from"./index-C4XDO3q4.js";import{A as de,a as oe,b as me,c as xe,d as he,e as ue,f as je,g as ge,h as pe}from"./alert-dialog-Co1IkATV.js";import{B as o}from"./badge-Befivxqe.js";import{H as ye}from"./heart-BFmbdgRc.js";import{E as T}from"./eye-L4evpcbO.js";import{S as fe}from"./search-BOIwQ3kk.js";import{T as we}from"./trash-2-DlTU7m4C.js";function Ee(){const[m,Y]=n.useState([]),[R,J]=n.useState([]),[G,K]=n.useState(!0),[p,Q]=n.useState(""),[y,D]=n.useState("all"),[a,N]=n.useState(null),[F,b]=n.useState(!1),[A,M]=n.useState(!1),{toast:x}=te();n.useEffect(()=>{q()},[]),n.useEffect(()=>{U()},[m,p,y]);const q=async()=>{try{const{data:s,error:r}=await S.from("prayer_requests").select("*").order("created_at",{ascending:!1});if(r)throw r;Y(s||[])}catch(s){console.error("Error loading prayer requests:",s),x({title:"Error",description:"Failed to load prayer requests",variant:"destructive"})}finally{K(!1)}},U=()=>{let s=m;if(p&&(s=s.filter(r=>{var t;return r.name.toLowerCase().includes(p.toLowerCase())||r.request.toLowerCase().includes(p.toLowerCase())||((t=r.email)==null?void 0:t.toLowerCase().includes(p.toLowerCase()))})),y!=="all"){const r=y==="answered";s=s.filter(t=>t.is_answered===r)}J(s)},L=async(s,r)=>{try{const{error:t}=await S.from("prayer_requests").update({is_answered:!r,updated_at:new Date().toISOString()}).eq("id",s);if(t)throw t;x({title:"Success",description:`Prayer request marked as ${r?"pending":"answered"}`}),q()}catch(t){console.error("Error updating prayer request:",t),x({title:"Error",description:"Failed to update prayer request",variant:"destructive"})}},X=async s=>{try{const{error:r}=await S.from("prayer_requests").delete().eq("id",s);if(r)throw r;x({title:"Success",description:"Prayer request deleted successfully"}),q()}catch(r){console.error("Error deleting prayer request:",r),x({title:"Error",description:"Failed to delete prayer request",variant:"destructive"})}},Z=async s=>{if(s.preventDefault(),!a||!a.email)return;M(!0);const r=s.target,t=new FormData(r),k=t.get("subject"),_=t.get("message");try{if(!(await fetch("/api/send-email",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({to:a.email,subject:k,htmlContent:_.replace(/\n/g,"<br>")})})).ok)throw new Error("Failed to send email");await S.from("prayer_requests").update({is_answered:!0,updated_at:new Date().toISOString()}).eq("id",a.id),x({title:"Email Sent",description:`Response sent to ${a.name}`}),b(!1),N(null),q()}catch(i){console.error("Error sending email:",i),x({title:"Error",description:"Failed to send email response",variant:"destructive"})}finally{M(!1)}},c=(()=>{const s=m.length,r=m.filter(i=>i.is_answered).length,t=m.filter(i=>!i.is_answered).length,k=m.filter(i=>i.is_public).length,_=m.filter(i=>{const ee=new Date(i.created_at),E=new Date;return E.setDate(E.getDate()-7),ee>=E}).length;return{totalRequests:s,answeredRequests:r,pendingRequests:t,publicRequests:k,thisWeekRequests:_}})();return G?e.jsx(le,{className:"h-64",text:"Loading prayer requests...",ariaLabel:"Loading prayer requests"}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-church-burgundy",children:"Prayer Requests Management"}),e.jsx("p",{className:"text-gray-600",children:"Review and respond to prayer requests from the community"})]})}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-5",children:[e.jsxs(h,{children:[e.jsx(u,{className:"pb-2",children:e.jsxs(j,{className:"text-sm font-medium flex items-center",children:[e.jsx(ye,{className:"w-4 h-4 mr-2"}),"Total Requests"]})}),e.jsxs(g,{children:[e.jsx("div",{className:"text-2xl font-bold text-church-burgundy",children:c.totalRequests}),e.jsx("p",{className:"text-xs text-gray-500",children:"All time"})]})]}),e.jsxs(h,{children:[e.jsx(u,{className:"pb-2",children:e.jsxs(j,{className:"text-sm font-medium flex items-center",children:[e.jsx(v,{className:"w-4 h-4 mr-2"}),"Answered"]})}),e.jsxs(g,{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:c.answeredRequests}),e.jsxs("p",{className:"text-xs text-gray-500",children:[c.totalRequests>0?Math.round(c.answeredRequests/c.totalRequests*100):0,"% of total"]})]})]}),e.jsxs(h,{children:[e.jsx(u,{className:"pb-2",children:e.jsxs(j,{className:"text-sm font-medium flex items-center",children:[e.jsx(C,{className:"w-4 h-4 mr-2"}),"Pending"]})}),e.jsxs(g,{children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:c.pendingRequests}),e.jsx("p",{className:"text-xs text-gray-500",children:"Awaiting response"})]})]}),e.jsxs(h,{children:[e.jsx(u,{className:"pb-2",children:e.jsxs(j,{className:"text-sm font-medium flex items-center",children:[e.jsx(T,{className:"w-4 h-4 mr-2"}),"Public"]})}),e.jsxs(g,{children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:c.publicRequests}),e.jsx("p",{className:"text-xs text-gray-500",children:"Visible to community"})]})]}),e.jsxs(h,{children:[e.jsx(u,{className:"pb-2",children:e.jsxs(j,{className:"text-sm font-medium flex items-center",children:[e.jsx(ie,{className:"w-4 h-4 mr-2"}),"This Week"]})}),e.jsxs(g,{children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:c.thisWeekRequests}),e.jsx("p",{className:"text-xs text-gray-500",children:"New requests"})]})]})]}),e.jsxs(h,{children:[e.jsx(u,{children:e.jsx(j,{className:"text-lg",children:"Search & Filter"})}),e.jsx(g,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"search",children:"Search"}),e.jsxs("div",{className:"relative",children:[e.jsx(fe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(O,{id:"search",placeholder:"Search prayer requests...",value:p,onChange:s=>Q(s.target.value),className:"pl-10"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Status Filter"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(l,{variant:y==="all"?"default":"outline",size:"sm",onClick:()=>D("all"),children:"All"}),e.jsx(l,{variant:y==="pending"?"default":"outline",size:"sm",onClick:()=>D("pending"),children:"Pending"}),e.jsx(l,{variant:y==="answered"?"default":"outline",size:"sm",onClick:()=>D("answered"),children:"Answered"})]})]})]})})]}),e.jsxs(h,{children:[e.jsxs(u,{children:[e.jsxs(j,{children:["Prayer Requests (",R.length,")"]}),e.jsx(ne,{children:"Manage and respond to community prayer requests"})]}),e.jsxs(g,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(se,{children:[e.jsx(ae,{children:e.jsxs(z,{children:[e.jsx(f,{children:"Date"}),e.jsx(f,{children:"Name"}),e.jsx(f,{children:"Request"}),e.jsx(f,{children:"Status"}),e.jsx(f,{children:"Visibility"}),e.jsx(f,{children:"Actions"})]})}),e.jsx(re,{children:R.map(s=>e.jsxs(z,{children:[e.jsx(w,{children:H(new Date(s.created_at),"MMM d, yyyy")}),e.jsx(w,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.name}),s.email&&e.jsx("div",{className:"text-sm text-gray-500",children:s.email})]})}),e.jsx(w,{children:e.jsxs("div",{className:"max-w-xs",children:[e.jsx("p",{className:"truncate",children:s.request}),e.jsx(l,{variant:"link",size:"sm",className:"p-0 h-auto text-xs",onClick:()=>N(s),children:"Read full request"})]})}),e.jsx(w,{children:s.is_answered?e.jsxs(o,{className:"bg-green-100 text-green-800",children:[e.jsx(v,{className:"w-3 h-3 mr-1"}),"Answered"]}):e.jsxs(o,{className:"bg-yellow-100 text-yellow-800",children:[e.jsx(C,{className:"w-3 h-3 mr-1"}),"Pending"]})}),e.jsx(w,{children:s.is_public?e.jsxs(o,{className:"bg-blue-100 text-blue-800",children:[e.jsx(T,{className:"w-3 h-3 mr-1"}),"Public"]}):e.jsx(o,{className:"bg-gray-100 text-gray-800",children:"Private"})}),e.jsx(w,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(l,{variant:"outline",size:"sm",onClick:()=>L(s.id,s.is_answered),className:s.is_answered?"":"bg-green-50 hover:bg-green-100",children:s.is_answered?e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"w-3 h-3 mr-1"}),"Mark Pending"]}):e.jsxs(e.Fragment,{children:[e.jsx(v,{className:"w-3 h-3 mr-1"}),"Mark Answered"]})}),s.email&&e.jsxs(l,{variant:"outline",size:"sm",onClick:()=>{N(s),b(!0)},children:[e.jsx(P,{className:"w-3 h-3 mr-1"}),"Email"]}),e.jsxs(de,{children:[e.jsx(oe,{asChild:!0,children:e.jsx(l,{variant:"destructive",size:"sm",children:e.jsx(we,{className:"w-3 h-3"})})}),e.jsxs(me,{children:[e.jsxs(xe,{children:[e.jsx(he,{children:"Delete Prayer Request"}),e.jsxs(ue,{children:["Are you sure you want to delete this prayer request from ",s.name,"? This action cannot be undone."]})]}),e.jsxs(je,{children:[e.jsx(ge,{children:"Cancel"}),e.jsx(pe,{onClick:()=>X(s.id),className:"bg-red-600 hover:bg-red-700",children:"Delete"})]})]})]})]})})]},s.id))})]})}),R.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No prayer requests found matching your criteria."})]})]}),e.jsx(B,{open:!!a&&!F,onOpenChange:()=>N(null),children:e.jsxs(V,{className:"max-w-2xl",children:[e.jsxs(W,{children:[e.jsx(I,{children:"Prayer Request Details"}),e.jsx($,{children:a&&H(new Date(a.created_at),"MMMM d, yyyy 'at' h:mm a")})]}),a&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-medium",children:"From:"}),e.jsx("p",{className:"text-sm font-medium",children:a.name}),a.email&&e.jsx("p",{className:"text-sm text-gray-500",children:a.email})]}),e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-medium",children:"Prayer Request:"}),e.jsx("div",{className:"mt-2 p-4 bg-gray-50 rounded-md border-l-4 border-church-gold",children:e.jsx("p",{className:"text-sm leading-relaxed whitespace-pre-wrap",children:a.request})})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(d,{className:"text-sm",children:"Status:"}),a.is_answered?e.jsxs(o,{className:"bg-green-100 text-green-800",children:[e.jsx(v,{className:"w-3 h-3 mr-1"}),"Answered"]}):e.jsxs(o,{className:"bg-yellow-100 text-yellow-800",children:[e.jsx(C,{className:"w-3 h-3 mr-1"}),"Pending"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(d,{className:"text-sm",children:"Visibility:"}),a.is_public?e.jsxs(o,{className:"bg-blue-100 text-blue-800",children:[e.jsx(T,{className:"w-3 h-3 mr-1"}),"Public"]}):e.jsx(o,{className:"bg-gray-100 text-gray-800",children:"Private"})]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(l,{variant:"outline",onClick:()=>{L(a.id,a.is_answered),N(null)},className:a.is_answered?"":"bg-green-50 hover:bg-green-100",children:a.is_answered?e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"w-4 h-4 mr-2"}),"Mark Pending"]}):e.jsxs(e.Fragment,{children:[e.jsx(v,{className:"w-4 h-4 mr-2"}),"Mark Answered"]})}),a.email&&e.jsxs(l,{onClick:()=>b(!0),className:"bg-church-burgundy hover:bg-church-burgundy/90",children:[e.jsx(P,{className:"w-4 h-4 mr-2"}),"Send Email Response"]})]})]})]})]})}),e.jsx(B,{open:F,onOpenChange:b,children:e.jsxs(V,{className:"max-w-2xl",children:[e.jsxs(W,{children:[e.jsx(I,{children:"Send Email Response"}),e.jsxs($,{children:["Respond to ",a==null?void 0:a.name,"'s prayer request"]})]}),a&&e.jsxs("form",{onSubmit:Z,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"subject",children:"Subject"}),e.jsx(O,{id:"subject",name:"subject",defaultValue:"Re: Your Prayer Request",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"message",children:"Message"}),e.jsx(ce,{id:"message",name:"message",rows:6,placeholder:`Dear ${a.name},

Thank you for sharing your prayer request with us. We want you to know that we are praying for you and your situation.

[Your personal message here]

Blessings,
St. Gabriel Ethiopian Orthodox Church`,required:!0})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(l,{type:"submit",className:"flex-1 bg-church-burgundy hover:bg-church-burgundy/90",disabled:A,children:A?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Sending..."]}):e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"w-4 h-4 mr-2"}),"Send Email"]})}),e.jsx(l,{type:"button",variant:"outline",onClick:()=>b(!1),disabled:A,children:"Cancel"})]})]})]})})]})}export{Ee as default};
