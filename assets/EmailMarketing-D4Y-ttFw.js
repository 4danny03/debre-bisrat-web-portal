import{j as e}from"./ui-CIANOcUa.js";import{a as r}from"./vendor-Di3rkBj0.js";import{$ as E,a0 as U,O as c,a1 as M,a2 as D,a3 as k,ae as R,Y as b,a4 as L,a8 as me,a9 as xe,aa as he,ab as ue,ac as je,x,y as h,z as u,M as pe,J as j,u as ge,A as V,a5 as y,w as v,af as l}from"./index-C4XDO3q4.js";import{B as fe}from"./badge-Befivxqe.js";import{T as q,a as $,b as p,c as i,d as J,e as n}from"./table-CcA4TWxd.js";import{P as Y}from"./plus-CeiqPXVg.js";import{E as G}from"./eye-L4evpcbO.js";import{S as K}from"./square-pen-D4gMYDLN.js";import{S as Ne}from"./send-CiOxk7wu.js";import{T as be}from"./trash-2-DlTU7m4C.js";const ke=()=>{var H;const[d,Q]=r.useState([]),[g,W]=r.useState([]),[X,P]=r.useState(!0),[Z,S]=r.useState(!1),[ee,T]=r.useState(!1),[se,ae]=r.useState(""),[te,A]=r.useState(!1),[t,o]=r.useState({title:"",subject:"",content:"",scheduled_at:"",template_id:""}),[m,w]=r.useState({name:"",subject:"",content:""}),[C,_]=r.useState(""),[z,B]=r.useState(null),[F,O]=r.useState(null),re=async s=>{B(s);try{await v.from("email_campaigns").update({status:"cancelled"}).eq("id",s),l.success("Campaign cancelled successfully"),f()}catch{l.error("Failed to cancel campaign")}finally{B(null)}},le=async s=>{O(s);try{l.success("Campaign resent successfully"),f()}catch{l.error("Failed to resend campaign")}finally{O(null)}},f=async()=>{try{P(!0);const{data:s,error:a}=await v.from("email_campaigns").select("*").order("created_at",{ascending:!1});a?(console.error("Error loading campaigns:",a),l.error("Failed to load campaigns")):Q(s||[]);const{data:N,error:I}=await v.from("email_templates").select("*").order("created_at",{ascending:!1});I?(console.error("Error loading templates:",I),l.error("Failed to load templates")):W(N||[])}catch(s){console.error("Unexpected error:",s),l.error("An unexpected error occurred")}finally{P(!1)}};r.useEffect(()=>{f()},[]);const ne=async()=>{try{const{error:s}=await v.from("email_campaigns").insert({title:t.title,subject:t.subject,content:C||t.content,status:t.scheduled_at?"scheduled":"draft",scheduled_at:t.scheduled_at||null,recipient_count:0});if(s){console.error("Error creating campaign:",s),l.error("Failed to create campaign");return}l.success("Campaign created successfully"),S(!1),o({title:"",subject:"",content:"",scheduled_at:"",template_id:""}),_(""),f()}catch(s){console.error("Unexpected error:",s),l.error("An unexpected error occurred")}},ce=async()=>{try{const{error:s}=await v.from("email_templates").insert({name:m.name,subject:m.subject,content:m.content});if(s){console.error("Error creating template:",s),l.error("Failed to create template");return}l.success("Template created successfully"),T(!1),w({name:"",subject:"",content:""}),f()}catch(s){console.error("Unexpected error:",s),l.error("An unexpected error occurred")}},ie=s=>{const a=g.find(N=>N.id===s);a&&(o(N=>({...N,subject:a.subject,content:a.content,template_id:s})),_(a.content))},de=()=>{ae(C||t.content)},oe=s=>{switch(s){case"sent":return"default";case"scheduled":return"secondary";case"draft":return"outline";case"cancelled":return"destructive";default:return"outline"}};return X?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading email marketing data..."})]})}):e.jsxs("div",{className:"space-y-6 bg-background p-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Email Marketing"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage email campaigns and templates"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(E,{open:ee,onOpenChange:T,children:[e.jsx(U,{asChild:!0,children:e.jsxs(c,{variant:"outline",className:"flex items-center gap-2",children:[e.jsx(Y,{className:"h-4 w-4"}),"New Template"]})}),e.jsxs(M,{className:"max-w-2xl",children:[e.jsxs(D,{children:[e.jsx(k,{children:"Create Email Template"}),e.jsx(R,{children:"Create a reusable email template for campaigns"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(b,{placeholder:"Template name",value:m.name,onChange:s=>w(a=>({...a,name:s.target.value}))}),e.jsx(b,{placeholder:"Email subject",value:m.subject,onChange:s=>w(a=>({...a,subject:s.target.value}))}),e.jsx(L,{placeholder:"Email content",value:m.content,onChange:s=>w(a=>({...a,content:s.target.value})),rows:10}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(c,{variant:"outline",onClick:()=>T(!1),children:"Cancel"}),e.jsx(c,{onClick:ce,children:"Create Template"})]})]})]})]}),e.jsxs(E,{open:Z,onOpenChange:S,children:[e.jsx(U,{asChild:!0,children:e.jsxs(c,{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"h-4 w-4"}),"New Campaign"]})}),e.jsxs(M,{className:"max-w-4xl",children:[e.jsxs(D,{children:[e.jsx(k,{children:"Create Email Campaign"}),e.jsx(R,{children:"Create a new email campaign to send to your subscribers"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"md:col-span-2 space-y-4",children:[e.jsx(b,{placeholder:"Campaign title",value:t.title,onChange:s=>o(a=>({...a,title:s.target.value}))}),e.jsx(b,{placeholder:"Email subject",value:t.subject,onChange:s=>o(a=>({...a,subject:s.target.value}))}),e.jsxs(me,{value:t.template_id,onValueChange:ie,children:[e.jsx(xe,{children:e.jsx(he,{placeholder:"Select template (optional)"})}),e.jsx(ue,{children:g.map(s=>e.jsx(je,{value:s.id,children:s.name},s.id))})]}),e.jsx(L,{placeholder:"Email content",value:C||t.content,onChange:s=>{_(s.target.value),o(a=>({...a,content:s.target.value}))},rows:12}),e.jsx(b,{type:"datetime-local",placeholder:"Schedule for later (optional)",value:t.scheduled_at,onChange:s=>o(a=>({...a,scheduled_at:s.target.value}))})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Preview"}),e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>{de(),A(!0)},className:"w-full mb-2",children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"Preview Email"]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Subject:"})," ",t.subject||"No subject"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Content:"})," ",((H=C||t.content)==null?void 0:H.substring(0,100))||"No content","..."]})]})]})})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(c,{variant:"outline",onClick:()=>S(!1),children:"Cancel"}),e.jsx(c,{onClick:ne,children:"Create Campaign"})]})]})]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(x,{children:[e.jsxs(h,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(u,{className:"text-sm font-medium",children:"Total Campaigns"}),e.jsx(pe,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(j,{children:[e.jsx("div",{className:"text-2xl font-bold",children:d.length}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[d.filter(s=>s.status==="sent").length," sent"]})]})]}),e.jsxs(x,{children:[e.jsxs(h,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(u,{className:"text-sm font-medium",children:"Total Recipients"}),e.jsx(ge,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(j,{children:[e.jsx("div",{className:"text-2xl font-bold",children:d.reduce((s,a)=>s+(a.recipient_count||0),0)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Across all campaigns"})]})]}),e.jsxs(x,{children:[e.jsxs(h,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(u,{className:"text-sm font-medium",children:"Avg Open Rate"}),e.jsx(G,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(j,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[d.length>0?Math.round(d.reduce((s,a)=>s+(a.open_rate||0),0)/d.length):0,"%"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Email open rate"})]})]}),e.jsxs(x,{children:[e.jsxs(h,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(u,{className:"text-sm font-medium",children:"Templates"}),e.jsx(K,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(j,{children:[e.jsx("div",{className:"text-2xl font-bold",children:g.length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Reusable templates"})]})]})]}),e.jsxs(x,{children:[e.jsxs(h,{children:[e.jsx(u,{children:"Email Campaigns"}),e.jsx(V,{children:"Manage your email marketing campaigns"})]}),e.jsx(j,{children:e.jsx("div",{className:"rounded-md border",children:e.jsxs(q,{children:[e.jsx($,{children:e.jsxs(p,{children:[e.jsx(i,{children:"Campaign"}),e.jsx(i,{children:"Subject"}),e.jsx(i,{children:"Status"}),e.jsx(i,{children:"Recipients"}),e.jsx(i,{children:"Open Rate"}),e.jsx(i,{children:"Date"}),e.jsx(i,{children:"Actions"})]})}),e.jsx(J,{children:d.length===0?e.jsx(p,{children:e.jsx(n,{colSpan:7,className:"text-center py-8",children:e.jsx("div",{className:"text-muted-foreground",children:"No campaigns found. Create your first campaign to get started."})})}):d.map(s=>e.jsxs(p,{children:[e.jsx(n,{children:e.jsx("div",{className:"font-medium",children:s.title})}),e.jsx(n,{children:s.subject}),e.jsx(n,{children:e.jsx(fe,{variant:oe(s.status),children:s.status})}),e.jsx(n,{children:s.recipient_count||0}),e.jsx(n,{children:s.open_rate?`${s.open_rate}%`:"N/A"}),e.jsx(n,{children:s.sent_at?y(new Date(s.sent_at),"MMM dd, yyyy"):s.scheduled_at?y(new Date(s.scheduled_at),"MMM dd, yyyy"):y(new Date(s.created_at),"MMM dd, yyyy")}),e.jsx(n,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[s.status==="scheduled"&&e.jsx(c,{variant:"outline",size:"sm",onClick:()=>re(s.id),disabled:z===s.id,children:z===s.id?"Cancelling...":"Cancel"}),s.status==="sent"&&e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>le(s.id),disabled:F===s.id,children:[e.jsx(Ne,{className:"h-4 w-4"}),F===s.id?"Resending...":"Resend"]})]})})]},s.id))})]})})})]}),e.jsxs(x,{children:[e.jsxs(h,{children:[e.jsx(u,{children:"Email Templates"}),e.jsx(V,{children:"Reusable email templates for campaigns"})]}),e.jsx(j,{children:e.jsx("div",{className:"rounded-md border",children:e.jsxs(q,{children:[e.jsx($,{children:e.jsxs(p,{children:[e.jsx(i,{children:"Template Name"}),e.jsx(i,{children:"Subject"}),e.jsx(i,{children:"Created"}),e.jsx(i,{children:"Actions"})]})}),e.jsx(J,{children:g.length===0?e.jsx(p,{children:e.jsx(n,{colSpan:4,className:"text-center py-8",children:e.jsx("div",{className:"text-muted-foreground",children:"No templates found. Create your first template to get started."})})}):g.map(s=>e.jsxs(p,{children:[e.jsx(n,{children:e.jsx("div",{className:"font-medium",children:s.name})}),e.jsx(n,{children:s.subject}),e.jsx(n,{children:y(new Date(s.created_at),"MMM dd, yyyy")}),e.jsx(n,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(c,{variant:"outline",size:"sm",children:[e.jsx(K,{className:"h-4 w-4"}),"Edit"]}),e.jsxs(c,{variant:"outline",size:"sm",children:[e.jsx(be,{className:"h-4 w-4"}),"Delete"]})]})})]},s.id))})]})})})]}),e.jsx(E,{open:te,onOpenChange:A,children:e.jsxs(M,{className:"max-w-2xl",children:[e.jsxs(D,{children:[e.jsx(k,{children:"Email Preview"}),e.jsx(R,{children:"Preview how your email will look to recipients"})]}),e.jsxs("div",{className:"border rounded-lg p-4 bg-white",children:[e.jsx("div",{className:"mb-4 pb-4 border-b",children:e.jsxs("p",{children:[e.jsx("strong",{children:"Subject:"})," ",t.subject]})}),e.jsx("div",{className:"prose max-w-none",children:e.jsx("div",{dangerouslySetInnerHTML:{__html:se.replace(/\n/g,"<br>")}})})]})]})})]})};export{ke as default};
