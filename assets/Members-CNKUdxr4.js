import{j as e}from"./ui-CIANOcUa.js";import{a as n}from"./vendor-Di3rkBj0.js";import{T as se,a as ae,b as k,c as b,d as le,e as N}from"./table-CcA4TWxd.js";import{V as te,w as T,ad as re,$ as q,a0 as ie,O as x,a1 as H,a2 as U,a3 as z,W as d,Y as o,a8 as u,a9 as j,aa as p,ab as g,ac as a,x as _,y as S,z as w,J as C,A as ne,M as de,P as ce,a5 as oe,C as he,m as me,l as xe}from"./index-C4XDO3q4.js";import{A as ue,a as je,b as pe,c as ge,d as ve,e as fe,f as ye,g as be,h as Ne}from"./alert-dialog-Co1IkATV.js";import{B as D}from"./badge-Befivxqe.js";import{F as _e}from"./FileSaver.min-7_t4LXdi.js";import{U as Se}from"./user-plus-BYIiAgPk.js";import{S as we}from"./search-BOIwQ3kk.js";import{S as Ce}from"./square-pen-D4gMYDLN.js";import{T as De}from"./trash-2-DlTU7m4C.js";import{C as Ae}from"./circle-x-CW4isPra.js";function qe(){const[v,E]=n.useState([]),[A,J]=n.useState([]),[W,V]=n.useState(!0),[h,I]=n.useState(""),[f,L]=n.useState(""),[y,P]=n.useState(""),[X,O]=n.useState(!1),[c,F]=n.useState(null),{toast:m}=te(),[B,R]=n.useState(null);n.useEffect(()=>{M()},[]),n.useEffect(()=>{Y()},[v,h,f,y]);const M=async()=>{V(!0),R(null);const{data:s,error:l}=await T.from("members").select("*").order("created_at",{ascending:!1});if(l)R(l.message||"Failed to load members"),m({title:"Error",description:l.message||"Failed to load members",variant:"destructive"}),E([]);else{const t=(Array.isArray(s)?s:[]).map(r=>({...r,membership_type:(r==null?void 0:r.membership_type)||"regular",membership_status:(r==null?void 0:r.membership_status)||"pending",join_date:(r==null?void 0:r.join_date)||(r==null?void 0:r.created_at)||new Date().toISOString(),updated_at:(r==null?void 0:r.updated_at)||(r==null?void 0:r.created_at)||new Date().toISOString()}));E(t)}V(!1)},Y=()=>{let s=v;h&&(s=s.filter(l=>{var i,t,r;return((i=l.full_name)==null?void 0:i.toLowerCase().includes(h.toLowerCase()))||((t=l.email)==null?void 0:t.toLowerCase().includes(h.toLowerCase()))||((r=l.membership_type)==null?void 0:r.toLowerCase().includes(h.toLowerCase()))})),f&&f!=="all"&&(s=s.filter(l=>l.membership_status===f)),y&&y!=="all"&&(s=s.filter(l=>l.membership_type===y)),J(s)},$=async s=>{s.preventDefault();const l=s.target,i=new FormData(l);try{const{error:t}=await T.from("members").insert([{full_name:i.get("full_name"),email:i.get("email"),phone:i.get("phone"),address:i.get("address"),membership_type:i.get("membership_type"),membership_status:"active",join_date:new Date().toISOString().split("T")[0],membership_date:new Date().toISOString().split("T")[0],registration_date:new Date().toISOString().split("T")[0],first_name:i.get("full_name").split(" ")[0]||"",last_name:i.get("full_name").split(" ").slice(1).join(" ")||"",preferred_language:"english",email_updates:!0}]);if(t)throw t;m({title:"Success",description:"Member added successfully"}),M(),O(!1),l.reset()}catch(t){console.error("Error adding member:",t),m({title:"Error",description:"Failed to add member",variant:"destructive"})}},G=async s=>{if(s.preventDefault(),!c)return;const l=s.target,i=new FormData(l);try{const{error:t}=await T.from("members").update({full_name:i.get("full_name"),email:i.get("email"),phone:i.get("phone"),address:i.get("address"),membership_type:i.get("membership_type"),membership_status:i.get("membership_status"),updated_at:new Date().toISOString()}).eq("id",c.id);if(t)throw t;m({title:"Success",description:"Member updated successfully"}),M(),F(null)}catch(t){console.error("Error updating member:",t),m({title:"Error",description:"Failed to update member",variant:"destructive"})}},K=async s=>{try{const{error:l}=await T.from("members").delete().eq("id",s);if(l)throw l;m({title:"Success",description:"Member deleted successfully"}),M()}catch(l){console.error("Error deleting member:",l),m({title:"Error",description:"Failed to delete member",variant:"destructive"})}},Q=()=>{const l=[["ID","Full Name","Email","Phone","Type","Status","Join Date","Renewal Due"],...A.map(t=>[t.id,t.full_name,t.email||"",t.phone||"",t.membership_type,t.membership_status,t.join_date,t.next_renewal_date||""])].map(t=>t.join(",")).join(`
`),i=new Blob([l],{type:"text/csv"});_e.saveAs(i,"members.csv")},Z=s=>{switch(s){case"active":return e.jsxs(D,{className:"bg-green-100 text-green-800",children:[e.jsx(xe,{className:"w-3 h-3 mr-1"}),"Active"]});case"pending":return e.jsxs(D,{className:"bg-yellow-100 text-yellow-800",children:[e.jsx(me,{className:"w-3 h-3 mr-1"}),"Pending"]});case"inactive":return e.jsxs(D,{className:"bg-red-100 text-red-800",children:[e.jsx(Ae,{className:"w-3 h-3 mr-1"}),"Inactive"]});default:return e.jsx(D,{variant:"secondary",children:s})}},ee=s=>{const l={regular:"bg-blue-100 text-blue-800",student:"bg-purple-100 text-purple-800",senior:"bg-orange-100 text-orange-800",family:"bg-green-100 text-green-800"};return e.jsx(D,{className:l[s]||"bg-gray-100 text-gray-800",children:s})};return W?e.jsx(re,{className:"h-64",text:"Loading members...",ariaLabel:"Loading members"}):e.jsxs("div",{children:[B&&e.jsxs("div",{className:"bg-red-100 text-red-700 p-4 rounded mb-4",children:[e.jsx("b",{children:"Error:"})," ",B]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-church-burgundy",children:"Members Management"}),e.jsx("p",{className:"text-gray-600",children:"Manage church members and their information"})]}),e.jsxs(q,{open:X,onOpenChange:O,children:[e.jsx(ie,{asChild:!0,children:e.jsxs(x,{className:"bg-church-burgundy hover:bg-church-burgundy/90",children:[e.jsx(Se,{className:"w-4 h-4 mr-2"}),"Add Member"]})}),e.jsxs(H,{className:"max-w-md",children:[e.jsx(U,{children:e.jsx(z,{children:"Add New Member"})}),e.jsxs("form",{onSubmit:$,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"full_name",children:"Full Name"}),e.jsx(o,{id:"full_name",name:"full_name",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"email",children:"Email"}),e.jsx(o,{id:"email",name:"email",type:"email"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"phone",children:"Phone"}),e.jsx(o,{id:"phone",name:"phone",type:"tel"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"address",children:"Address"}),e.jsx(o,{id:"address",name:"address"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"membership_type",children:"Membership Type"}),e.jsxs(u,{name:"membership_type",defaultValue:"regular",children:[e.jsx(j,{children:e.jsx(p,{})}),e.jsxs(g,{children:[e.jsx(a,{value:"regular",children:"Regular"}),e.jsx(a,{value:"student",children:"Student"}),e.jsx(a,{value:"senior",children:"Senior"}),e.jsx(a,{value:"family",children:"Family"})]})]})]}),e.jsx(x,{type:"submit",className:"w-full",children:"Add Member"})]})]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsxs(_,{children:[e.jsx(S,{className:"pb-2",children:e.jsx(w,{className:"text-sm font-medium",children:"Total Members"})}),e.jsx(C,{children:e.jsx("div",{className:"text-2xl font-bold text-church-burgundy",children:v.length})})]}),e.jsxs(_,{children:[e.jsx(S,{className:"pb-2",children:e.jsx(w,{className:"text-sm font-medium",children:"Active Members"})}),e.jsx(C,{children:e.jsx("div",{className:"text-2xl font-bold text-green-600",children:v.filter(s=>s.membership_status==="active").length})})]}),e.jsxs(_,{children:[e.jsx(S,{className:"pb-2",children:e.jsx(w,{className:"text-sm font-medium",children:"Pending Members"})}),e.jsx(C,{children:e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:v.filter(s=>s.membership_status==="pending").length})})]}),e.jsxs(_,{children:[e.jsx(S,{className:"pb-2",children:e.jsx(w,{className:"text-sm font-medium",children:"Family Members"})}),e.jsx(C,{children:e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:v.filter(s=>s.membership_type==="family").length})})]})]}),e.jsxs(_,{children:[e.jsx(S,{children:e.jsx(w,{className:"text-lg",children:"Search & Filter"})}),e.jsx(C,{children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(we,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(o,{placeholder:"Search by name, email, or phone...",value:h,onChange:s=>I(s.target.value),className:"pl-10"})]})}),e.jsxs(u,{value:f,onValueChange:L,children:[e.jsx(j,{className:"w-full md:w-48",children:e.jsx(p,{placeholder:"Filter by status"})}),e.jsxs(g,{children:[e.jsx(a,{value:"all",children:"All Statuses"}),e.jsx(a,{value:"active",children:"Active"}),e.jsx(a,{value:"pending",children:"Pending"}),e.jsx(a,{value:"inactive",children:"Inactive"})]})]}),e.jsxs(u,{value:y,onValueChange:P,children:[e.jsx(j,{className:"w-full md:w-48",children:e.jsx(p,{placeholder:"Filter by type"})}),e.jsxs(g,{children:[e.jsx(a,{value:"all",children:"All Types"}),e.jsx(a,{value:"regular",children:"Regular"}),e.jsx(a,{value:"student",children:"Student"}),e.jsx(a,{value:"senior",children:"Senior"}),e.jsx(a,{value:"family",children:"Family"})]})]})]})})]}),e.jsxs(_,{children:[e.jsxs(S,{children:[e.jsxs(w,{children:["Members (",A.length,")"]}),e.jsx(ne,{children:"Manage your church members"})]}),e.jsxs(C,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(se,{children:[e.jsx(ae,{children:e.jsxs(k,{children:[e.jsx(b,{children:"Name"}),e.jsx(b,{children:"Contact"}),e.jsx(b,{children:"Type"}),e.jsx(b,{children:"Status"}),e.jsx(b,{children:"Join Date"}),e.jsx(b,{children:"Actions"})]})}),e.jsx(le,{children:A.map(s=>e.jsxs(k,{children:[e.jsx(N,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.full_name}),s.address&&e.jsx("div",{className:"text-sm text-gray-500",children:s.address})]})}),e.jsx(N,{children:e.jsxs("div",{className:"space-y-1",children:[s.email&&e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx(de,{className:"w-3 h-3 mr-1"}),s.email]}),s.phone&&e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx(ce,{className:"w-3 h-3 mr-1"}),s.phone]})]})}),e.jsx(N,{children:ee(s.membership_type||"regular")}),e.jsx(N,{children:Z(s.membership_status||"active")}),e.jsx(N,{children:e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx(he,{className:"w-3 h-3 mr-1"}),s.join_date?oe(new Date(s.join_date),"MMM d, yyyy"):"N/A"]})}),e.jsx(N,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(x,{variant:"outline",size:"sm",onClick:()=>F(s),children:e.jsx(Ce,{className:"w-3 h-3"})}),e.jsxs(ue,{children:[e.jsx(je,{asChild:!0,children:e.jsx(x,{variant:"destructive",size:"sm",children:e.jsx(De,{className:"w-3 h-3"})})}),e.jsxs(pe,{children:[e.jsxs(ge,{children:[e.jsx(ve,{children:"Delete Member"}),e.jsxs(fe,{children:["Are you sure you want to delete"," ",s.full_name,"? This action cannot be undone."]})]}),e.jsxs(ye,{children:[e.jsx(be,{children:"Cancel"}),e.jsx(Ne,{onClick:()=>K(s.id),className:"bg-red-600 hover:bg-red-700",children:"Delete"})]})]})]})]})})]},s.id))})]})}),A.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No members found matching your criteria."})]})]}),e.jsx(q,{open:!!c,onOpenChange:()=>F(null),children:e.jsxs(H,{className:"max-w-md",children:[e.jsx(U,{children:e.jsx(z,{children:"Edit Member"})}),c&&e.jsxs("form",{onSubmit:G,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"edit_full_name",children:"Full Name"}),e.jsx(o,{id:"edit_full_name",name:"full_name",defaultValue:c.full_name,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"edit_email",children:"Email"}),e.jsx(o,{id:"edit_email",name:"email",type:"email",defaultValue:c.email||""})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"edit_phone",children:"Phone"}),e.jsx(o,{id:"edit_phone",name:"phone",type:"tel",defaultValue:c.phone||""})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"edit_address",children:"Address"}),e.jsx(o,{id:"edit_address",name:"address",defaultValue:c.address||""})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"edit_membership_type",children:"Membership Type"}),e.jsxs(u,{name:"membership_type",defaultValue:c.membership_type||"regular",children:[e.jsx(j,{children:e.jsx(p,{})}),e.jsxs(g,{children:[e.jsx(a,{value:"regular",children:"Regular"}),e.jsx(a,{value:"student",children:"Student"}),e.jsx(a,{value:"senior",children:"Senior"}),e.jsx(a,{value:"family",children:"Family"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"edit_membership_status",children:"Status"}),e.jsxs(u,{name:"membership_status",defaultValue:c.membership_status||"active",children:[e.jsx(j,{children:e.jsx(p,{})}),e.jsxs(g,{children:[e.jsx(a,{value:"active",children:"Active"}),e.jsx(a,{value:"pending",children:"Pending"}),e.jsx(a,{value:"inactive",children:"Inactive"})]})]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(x,{type:"submit",className:"flex-1",children:"Update Member"}),e.jsx(x,{type:"button",variant:"outline",onClick:()=>F(null),children:"Cancel"})]})]})]})}),e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsx(o,{placeholder:"Search by name, email, or type...",value:h,onChange:s=>I(s.target.value)}),e.jsxs(u,{value:f,onValueChange:L,children:[e.jsx(j,{children:e.jsx(p,{placeholder:"Status"})}),e.jsxs(g,{children:[e.jsx(a,{value:"all",children:"All"}),e.jsx(a,{value:"pending",children:"Pending"}),e.jsx(a,{value:"active",children:"Active"}),e.jsx(a,{value:"inactive",children:"Inactive"})]})]}),e.jsxs(u,{value:y,onValueChange:P,children:[e.jsx(j,{children:e.jsx(p,{placeholder:"Type"})}),e.jsxs(g,{children:[e.jsx(a,{value:"all",children:"All"}),e.jsx(a,{value:"regular",children:"Regular"}),e.jsx(a,{value:"student",children:"Student"}),e.jsx(a,{value:"senior",children:"Senior"}),e.jsx(a,{value:"family",children:"Family"})]})]}),e.jsx(x,{onClick:Q,children:"Export CSV"})]}),e.jsxs("div",{className:"mt-8",children:[e.jsx("h3",{className:"text-lg font-bold mb-2",children:"Activity Log"}),e.jsx("div",{className:"text-sm text-gray-500",children:"(Activity log will appear here)"})]})]})]})}export{qe as default};
